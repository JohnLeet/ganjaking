/**
 * URL shortener Admin Script Doc Comment
 *
 * @category Script
 * @package  Yith Custom Thank You Page for Woocommerce
 * @author    Armando Liccardo
 * @license  http://www.gnu.org/licenses/gpl-3.0.txt GNU GENERAL PUBLIC LICENSE (GPL 3.0)
 * @link http://www.yithemes.com
 */
jQuery(function(t){t(document).ready(function(){"use strict";function e(e,a){var _={action:"yith_ctpw_get_edit_page_url",ctpw_id:e};"main_settings"===a?(t(".single_select_page .yith_ctpw_edit_page_url_link").remove(),t.post(ajaxurl,_,function(e){!1!==e&&t("tr.single_select_page td .select2 .selection").append('<a style="text-decoration: none; position: absolute; top: 8px; right: 40px;" class="yith_ctpw_edit_page_url_link" target="_blank" href="'+e+'">Edit</a>')})):"product_cat_settings"===a?(t("tr.yith_ctpw_cat_page .yith_ctpw_edit_page_url_link").remove(),t.post(ajaxurl,_,function(e){!1!==e&&t("tr.yith_ctpw_cat_page td").append('<a style="text-decoration: none;" class="yith_ctpw_edit_page_url_link" target="_blank" href="'+e+'">Edit</a>')})):"single_p_tab_settings"===a&&(t("#ctpw_tab_data .yith_ctpw_product_thankyou_page_id .yith_ctpw_edit_page_url_link").remove(),t.post(ajaxurl,_,function(e){!1!==e&&t("#ctpw_tab_data .yith_ctpw_product_thankyou_page_id").append('<a style="text-decoration: none; margin-left: 4px;" class="yith_ctpw_edit_page_url_link" target="_blank" href="'+e+'">Edit</a>')}))}t("#ctpw_url_shortening").change(function(){let e=t("option:selected",this).val(),a=t("#ctpw_google_api_key"),_=t("#ctpw_bitly_access_token");switch(e){case"bitly":_.parent().parent().show(),_.prop("required",!0),a.parent().parent().hide(),a.prop("required",!1);break;case"google":_.parent().parent().hide(),_.prop("required",!1),a.parent().parent().show(),a.prop("required",!0);break;default:_.parent().parent().hide(),_.prop("required",!1),a.parent().parent().hide(),a.prop("required",!1)}}).change(),t("#yith_ctpw_general_page_or_url").change(function(){let e=t("option:selected",this).val(),a=t("#yith_ctpw_general_page"),_=t("#yith_ctpw_general_page_url");switch(e){case"ctpw_page":a.parent().parent().show(),_.parent().parent().hide();break;case"ctpw_url":_.parent().parent().show(),a.parent().parent().hide();break;default:a.parent().parent().hide(),_.parent().parent().hide()}}).change(),t("#yith_ctpw_or_url_product_cat_thankyou_page").change(function(){let e=t("option:selected",this).val(),a=t("#yith_ctpw_product_cat_thankyou_page"),_=t("#yith_ctpw_url_product_cat_thankyou_page");switch(e){case"ctpw_page":a.parent().parent().show(),_.parent().parent().hide();break;case"ctpw_url":_.parent().parent().show(),a.parent().parent().hide();break;default:a.parent().parent().hide(),_.parent().parent().hide()}}).change(),t("#ctpw_tab_data #yith_ctpw_product_thankyou_page_url").change(function(){let e=t("option:selected",this).val(),a=t("#yith_product_thankyou_page"),_=t("#yith_ctpw_product_thankyou_url");switch(e){case"ctpw_page":a.parent().show(),_.parent().hide();break;case"ctpw_url":_.parent().show(),a.parent().hide();break;default:a.parent().hide(),_.parent().hide()}}).change(),t("#woocommerce-product-data").on("woocommerce_variations_loaded",function(){t(".woocommerce_variation .yith_ctpw .yith_ctpw_product_thankyou_page_url").change(function(){let e="."+t(this).parent().attr("ctpw_item"),a=t("option:selected",this).val(),_=t(e+" .yith_ctpw_product_thankyou_page"),p=t(e+" .yith_ctpw_product_thankyou_url");switch(a){case"ctpw_page":_.show(),p.hide();break;case"ctpw_url":p.show(),_.hide();break;default:_.hide(),p.hide()}}).change()}),t("#yith_ctpw_panel_payment_gateways .yith_ctpw_general_page_or_url").change(function(){var e=t(this).attr("ctpw_pg_id"),a=t("option:selected",this).val(),_="#yith_ctpw_url_for_"+e,p=t("#yith_ctpw_page_for_"+e),r=t(_);switch(a){case"ctpw_page":p.parent().parent().show(),r.parent().parent().hide();break;case"ctpw_url":r.parent().parent().show(),p.parent().parent().hide();break;default:p.parent().parent().hide(),r.parent().parent().hide()}}).change(),""!==t("select#yith_ctpw_general_page").val()&&e(t("select#yith_ctpw_general_page").val(),"main_settings"),t("select#yith_ctpw_general_page").change(function(){e(t(this).val(),"main_settings")}),0!==t("select#yith_ctpw_product_cat_thankyou_page").val()&&e(t("select#yith_ctpw_product_cat_thankyou_page").val(),"product_cat_settings"),t("select#yith_ctpw_product_cat_thankyou_page").change(function(){e(t(this).val(),"product_cat_settings")}),"0"!==t("#ctpw_tab_data .yith_ctpw_product_thankyou_page_id select").val()&&e(t("#ctpw_tab_data .yith_ctpw_product_thankyou_page_id select").val(),"single_p_tab_settings"),t("#ctpw_tab_data .yith_ctpw_product_thankyou_page_id select").change(function(){e(t(this).val(),"single_p_tab_settings")});var a=t(".yctpw_pdf_preview_backend");"no"===t("#yith_ctpw_enable_pdf").val()&&"no"===t("#yith_ctpw_enable_pdf_as_shortcode").val()&&a.remove(),a.on("click",function(){if(""!==yith_ctpw_ajax.order_id.trim()){console.log("YCTPW Starting Preview process"),t(this).css("pointer-events","none"),t(this).after('<img class="yith_ctpw_loading" src="'+yith_ctpw_ajax.loading_gif+'" />');const e=t("#yith_ctpw_pdf_show_order_header").val(),a=t("#yith_ctpw_pdf_show_order_details_table").val(),_=t("#yith_ctpw_pdf_show_customer_details").val(),p={show_logo:t("#yith_ctpw_pdf_show_logo").val(),logo_image_url:t("#yith_ctpw_pdf_custom_logo").val(),show_order_header_table:e,show_order_details_table:a,show_customer_details:_,footer_text:t("#yith_ctpw_pdf_footer_text").val()};t.ajax({type:"POST",url:yith_ctpw_ajax.ajaxurl,data:{action:"yith_ctpw_get_pdf",order_id:yith_ctpw_ajax.order_id,backend_preview:!0,preview_settings:p},dataType:"json",success:function(e,a,_){if(e.status&&""!==e.file){console.log("YCTPW Preview status: "+e.status);var p=e.file,r=t(window).height(),i=t(window).width(),c=r-200,n=i-200>600?600:i-200,o=n/2,d=c/2;t("body").append('<div id="yctpw_pdf_preview_overlay"></div><div id="yctpw_pdf_preview" style="width:'+n+"px; height:"+c+"px; top: 50%; left: 50%; margin-top: -"+d+"px; margin-left: -"+o+'px;"><div id="yctpw_pdf_preview_close">X</div><iframe id="yctpw_pdf_preview_frame"></iframe></div>'),setTimeout(function(){t("#yctpw_pdf_preview_frame").contents().find("html").html(p)},1e3),t("#yctpw_pdf_preview_close").on("click",function(){t(this).parent().remove(),t("#yctpw_pdf_preview_overlay").remove()}),setTimeout(function(){t(".yith_ctpw_loading").remove(),t(".yctpw_pdf_preview_backend").css("pointer-events","all")},500)}},error:function(t){console.log("yith_ctpw_pdf_preview_error")}})}else alert(yith_ctpw_ajax.no_valid_order_message)});const _=t(".yctpw-rules"),p=_.find("select#item_type");p.on("change",function(){switch(t(this).val()){case"product":_.find(".product_id").show(),_.find(".category_id").hide(),_.find(".payment_method").hide();break;case"product_category":_.find(".category_id").show(),_.find(".product_id").hide(),_.find(".payment_method").hide();break;case"payment_method":_.find(".category_id").hide(),_.find(".product_id").hide(),_.find(".payment_method").show()}}),p.trigger("change");const r=_.find("#yith_ctpw_general_page_or_url");r.on("change",function(){switch(t(this).val()){case"ctpw_page":_.find(".yith_thankyou_page").show(),_.find(".yith_thankyou_url").hide();break;case"ctpw_url":_.find(".yith_thankyou_url").show(),_.find(".yith_thankyou_page").hide()}}),r.trigger("change"),t(".yctpw-rules #yctpw_save_button").on("click",function(e){var a=!1;const _=t(".yctpw-rules #item_type").val();e.preventDefault();const p=t(".yctpw-rules #product_id");"product"!==_||""!==p.val()&&null!==p.val()?p.next().removeClass("yctpw_error"):(a=!0,p.next().addClass("yctpw_error"));const r=t(".yctpw-rules #category_id");"category"!==_||""!==r.val()&&null!==r.val()?r.next().removeClass("yctpw_error"):(a=!0,r.next().addClass("yctpw_error"));const i=t(".yctpw-rules #yith_ctpw_general_page_or_url").val(),c=t(".yctpw-rules #yith_thankyou_page");"ctpw_page"!==i||0!==c.val()&&"0"!==c.val()?c.removeClass("yctpw_error"):(c.addClass("yctpw_error"),a=!0);const n=t(".yctpw-rules #yith_thankyou_url");"ctpw_url"===i&&""===n.val()?(n.addClass("yctpw_error"),a=!0):n.removeClass("yctpw_error"),!1===a&&t(".yctpw-rules form#form").submit()})})});