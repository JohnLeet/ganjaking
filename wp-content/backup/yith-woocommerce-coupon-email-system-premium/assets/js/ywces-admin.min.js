jQuery(function(u){u("body").on("click","button.ywces-send-test-email",function(){var s=u(this).next(),e=u(this).prev().attr("value"),a=u(this).prev().attr("id").replace("ywces_test_",""),i=u("#ywces_mail_template").val()||"base",t="",n="",d="",c="",l="",o="0"!==ywces_admin.vendor_id?"_"+ywces_admin.vendor_id:"";if(s.show(),s.removeClass("send-progress send-fail send-success"),/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)){switch(a){case"purchases":case"spending":var r=u("#ywces_thresholds_"+a+o);if(0===r.find("tr.threshold").size())return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_no_threshold);r.find("tr.threshold").each(function(){var e=u(this).find(".ywces-threshold-coupon").val(),s=u(this).find(".ywces-threshold-amount").val();""!==e&&(t=e,n=s)});break;case"product_purchasing":case"birthday":case"last_purchase":if("product_purchasing"===a){if(""===(d=u("#ywces_targets_product_purchasing"+o).val()))return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_no_product)}else if("last_purchase"===a&&""===(l=u("#ywces_days_last_purchase"+o).val()))return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_days_elapsed);var _=u("#ywces_coupon_"+a+"_settings"+o);if(""===_.find(".ywces-coupon-amount").val())return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_no_amount);c={discount_type:_.find(".ywces-discount-type").val(),coupon_amount:_.find(".ywces-coupon-amount").val(),expiry_days:_.find(".ywces-expiry-days").val(),minimum_amount:_.find(".ywces-minimum-amount").val(),maximum_amount:_.find(".ywces-maximum-amount").val(),free_shipping:_.find(".ywces-free-shipping").is(":checked")?"yes":"",individual_use:_.find(".ywces-individual-use").is(":checked")?"yes":"",exclude_sale_items:_.find(".ywces-exclude-sale-items").is(":checked")?"yes":""};break;default:t=u("#ywces_coupon_"+a+o).val()}var m={action:"ywces_send_test_mail",email:e,type:a,coupon:t,threshold:n,template:i,products:d,coupon_info:c,days_elapsed:l,vendor_id:"0"!==ywces_admin.vendor_id?ywces_admin.vendor_id:""};s.addClass("send-progress"),s.html(ywces_admin.before_send_test_email),u.post(ywces_admin.ajax_url,m,function(e){s.removeClass("send-progress"),!0===e?(s.addClass("send-success"),s.html(ywces_admin.after_send_test_email)):(s.addClass("send-fail"),s.html(e.error))})}else s.addClass("send-fail"),s.html(ywces_admin.test_mail_wrong)}).on("click","button.ywces-purge-coupon",function(){var s=u(".ywces-clear-result");s.show(),u(this).hide(),u.post(ywces_admin.ajax_url,{action:"ywces_clear_expired_coupons"},function(e){s.removeClass("clear-progress"),e.success?(s.addClass("clear-success"),s.html(e.message)):(s.addClass("clear-fail"),s.html(e.error))})}),u(document).ready(function(e){var s=e(".ywces-collapse");s.each(function(){e(this).toggleClass("expand").nextUntil("tr.ywces-collapse").slideToggle(100)}),s.click(function(){e(this).toggleClass("expand").nextUntil("tr.ywces-collapse").slideToggle(100)}),e("#ywces_mail_template_enable").change(function(){e(this).is(":checked")?(e("#ywces_mail_template").val("base").prop("disabled",!0),e(".ywces-mailskin").hide()):(e("#ywces_mail_template").prop("disabled",!1),e(".ywces-mailskin").show())}).change()})});