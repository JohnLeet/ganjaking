jQuery(function(o){"use strict";var c=o("#_yith_wcpb_per_item_pricing"),n=o("#_yith_wcpb_non_bundled_shipping"),t=o("select#product-type"),e=o("#_ywcnp_enabled_product"),a=woocommerce_admin_meta_boxes.post_id,d={message:null,overlayCSS:{background:"#fff",opacity:.7}},r={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200},i=function(){return"yith_bundle"===t.val()},_={el:{add_item_btn:o("#yith-wcpb-add-bundled-product"),bundled_items:o("#yith_bundled_product_data .yith-wcpb-bundled-items"),items_count:o("#yith_bundled_product_data .yith-wcpb-bundled-items .yith-wcpb-bundled-item").size()+1,ajax_filter_products:null},init:function(){this.el.add_item_btn.on("click",this.select_products),o(document).on("click",".yith-wcpb-add-product",this.add_item),o(document).on("keyup","input.yith-wcpb-select-product-box__filter__search",this.search_filter),o(document).on("click",".yith-wcpb-remove-bundled-product-item",this.remove_current_item),o(document).on("click",".yith-wcpb-bundled-item h3 a",this.stop_event_propagation),o(document).on("click",".yith-wcpb-select-product-box__products__pagination .first:not(.disabled)",this.paginate),o(document).on("click",".yith-wcpb-select-product-box__products__pagination .prev:not(.disabled)",this.paginate),o(document).on("click",".yith-wcpb-select-product-box__products__pagination .next:not(.disabled)",this.paginate),o(document).on("click",".yith-wcpb-select-product-box__products__pagination .last:not(.disabled)",this.paginate),this.sorting()},add_item:function(){var t=o(this).closest("tr").find(".yith-wcpb-product-added"),e=o(this).data("id"),i=o(this).closest(".yith-wcpb-select-product-box__products");if(e){i.block(d);var c={action:"yith_wcpb_add_product_in_bundle",open_closed:"open",post_id:a,id:_.el.items_count,product_id:e};o.ajax({type:"POST",url:ajaxurl,data:c,success:function(t){t.error?alert(t.error):t.html&&(_.el.bundled_items.append(t.html),_.el.bundled_items.find(".help_tip, .woocommerce-help-tip").tipTip(r),o("body").trigger("wc-enhanced-select-init"),_.el.items_count++)},complete:function(){i.unblock(),t.fadeIn().delay(1e3).fadeOut()}})}},remove_current_item:function(){o(this).parent().parent().remove()},filter_products:function(t){t.s!==undefined&&t.s.length<ajax_object.minimum_characters&&(t.s=""),t=o.extend(t,{action:"yith_wcpb_select_product_box_filtered"});var i=o(".yith-wcpb-select-product-box__products");i.block(d),_.el.ajax_filter_products&&_.el.ajax_filter_products.abort(),_.el.ajax_filter_products=o.ajax({type:"POST",url:ajaxurl,data:t,success:function(t){i.html(t)},complete:function(t,e){"abort"!==e&&i.unblock(d)}})},paginate:function(){var t=o(this).data("page");if(t!==undefined){var e=o("input.yith-wcpb-select-product-box__filter__search").val();_.filter_products({s:e,page:t})}},search_filter:function(){var t=o(this).val();(!t||t.length>=ajax_object.minimum_characters)&&_.filter_products({s:t})},select_products:function(){o.fn.yith_wcpb_popup({ajax:!0,url:ajaxurl,ajax_data:{action:"yith_wcpb_select_product_box"},ajax_success:function(){o(".yith-wcpb-select-product-box__filter__search").focus()}})},sorting:function(){var t=this.el.bundled_items.find(".yith-wcpb-bundled-item").get();t.sort(function(t,e){var i=parseInt(o(t).attr("rel")),c=parseInt(o(e).attr("rel"));return i<c?-1:c<i?1:0}),o(t).each(function(t,e){_.el.bundled_items.append(e)}),this.el.bundled_items.sortable({items:".yith-wcpb-bundled-item",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")}})},stop_event_propagation:function(t){t.stopPropagation()}};_.init(),o("body").on("woocommerce-product-type-change",function(t,e,i){"yith_bundle"===e?(o(".show_if_external").hide(),o(".show_if_simple").show(),o(".show_if_bundle").show(),o("input#_downloadable").prop("checked",!1).closest(".show_if_simple").hide(),o("input#_virtual").removeAttr("checked").closest(".show_if_simple").hide(),o("input#_manage_stock").change(),c.change(),n.change(),o(".product_price_rule").hide(),o(".hide_if_bundle").hide(),o("#_nyp").change()):(o(".product_price_rule").show(),o(".show_if_bundle").hide(),o(".hide_if_bundle").show())}),t.change(),c.on("change",function(){i()&&(o(this).is(":checked")?(o("#_regular_price").val(""),o("#_sale_price").val(""),o(".pricing").hide(),e.length&&e.parent().hide()):(o(".pricing").show(),o(".product_data_tabs").find("li.general_options").show(),e.length&&e.change().parent().show()))}),c.change(),n.on("change",function(){i()&&(o(this).is(":checked")?(o(".show_if_virtual").show(),o(".hide_if_virtual").hide(),o(".shipping_tab").hasClass("active")&&o("ul.product_data_tabs li:visible").eq(0).find("a").click()):(o(".show_if_virtual").hide(),o(".hide_if_virtual").show()))}),n.change()});