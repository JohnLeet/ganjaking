var get_unique_id=function(e,t){return e===undefined&&(e="_"),t===undefined&&(t=13),e+Math.random().toString(t).substr(2,t)},calendar=jQuery("#ywcdd_general_calendar"),block_params={message:null,overlayCSS:{background:"#fff",opacity:.6},ignoreIfBlocked:!0},render_calendar=function(){calendar.data("ywcdd_events_json");calendar.fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},defaultDate:ywcdd_calendar_params.starday,locale:ywcdd_calendar_params.calendar_language,aspectRatio:1.8,editable:!1,eventLimit:!0,timeFormat:"H:mm",buttonIcons:!1,navLinks:!0,lazyFetching:!0,showNonCurrentDates:!1,events:function(e,t,a,n){var d={action:ywcdd_calendar_params.actions.show_current_month,start_date:e.format(),end_date:t.format()};jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url,data:d,dataType:"json",beforeSend:function(){jQuery("#ywcdd_general_calendar").block(block_params)},success:function(e){n(e)},complete:function(){jQuery("#ywcdd_general_calendar").unblock()}})},eventRender:function(a,e,t){"holiday"==a.event_type&&(e.append("<span class='ywcdd_delete_calendar'></span>"),e.on("click",".ywcdd_delete_calendar",function(e){var t={ywcdd_event_id:a.id,action:ywcdd_calendar_params.actions.delete_calendar_holidays};jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url,data:t,dataType:"json",success:function(e){"deleted"===e.result&&jQuery("#ywcdd_general_calendar").fullCalendar("removeEvents",a.id)}})})),e.find(".fc-title").html(e.find(".fc-title").text())}}),jQuery(".fc-button-group button").addClass("button-primary"),jQuery(".fc-left button.fc-prev-button").html("< "+jQuery(".fc-left button.fc-prev-button").html()),jQuery(".fc-left button.fc-next-button").html(jQuery(".fc-left button.fc-next-button").html()+" >")},getDate=function(e){var t;try{t=$.datepicker.parseDate(ywcdd_calendar_params.dateformat,e.value)}catch(a){console.log(a),t=null}return t},saveHolidayElement=function(t,a){var e=t.serializeToggleElement();jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url+"?action="+ywcdd_calendar_params.actions.add_holidays,data:e,contentType:!1,processData:!1,success:function(e){a&&a.removeClass("show"),e.title&&t.find(".yith-toggle-title .title").html(e.title),e.subtitle&&t.find(".yith-toggle-title .subtitle").html(e.subtitle),calendar.fullCalendar("refetchEvents")}})},updateHolidayElement=function(e,t){var a=e.serializeToggleElement();jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url+"?action="+ywcdd_calendar_params.actions.update_holidays,data:a,contentType:!1,processData:!1,success:function(e){t&&t.removeClass("show"),calendar.fullCalendar("refetchEvents")}})},deleteHolidayElement=function(e){var t={item_key:e.data("item_key"),action:ywcdd_calendar_params.actions.delete_holidays};jQuery.ajax({type:"POST",url:ywcdd_calendar_params.ajax_url,data:t,dataType:"json",beforeSend:function(){jQuery("#ywcdd_general_calendar").block()},success:function(e){e.result;calendar.fullCalendar("refetchEvents")}})},init_datepicker=function(){jQuery(document).find(".ywcdd_datepicker").each(function(){jQuery(this).datepicker("destroy"),jQuery(this).datepicker({dateFormat:ywcdd_calendar_params.dateformat})}),jQuery(document).find(".holiday_from").datepicker("option","minDate",0).on("change",function(){var e=jQuery(this),t=e.parent().parent().parent().find(".holiday_to");""!==e.val()?t.datepicker("option","minDate",getDate(this)):t.datepicker("option","minDate",0)})};jQuery(document).ready(function(o){o("#yith_delivery_date_panel_general-calendar").length&&(o(document).off("click",".yith-add-box-buttons .yith-save-button"),o(document).off("click",".yith-toggle-row .yith-save-button"),o(document).off("click",".yith-toggle-onoff"),o(document).off("click",".yith-toggle-row .yith-delete-button")),o(document).on("click","#ywcdd_holidays_option_add_box .yith-save-button",function(e){e.preventDefault();var t=o(this).parents(".yith-add-box"),a=o(this).closest(".yith-toggle_wrapper").attr("id"),n=t.find(".spinner"),d=o(this).parents(".toggle-element"),l=t.find(":input"),i=get_unique_id("ywcdd_holiday_"),r=wp.template("yith-toggle-element-item-"+a),c=o(r({index:i}));"yes"===t.checkRequiredFields()&&(n.addClass("show"),o.each(l,function(e,t){void 0!==o(t).attr("id")&&($field_id=o(t).attr("id"),$field_id=$field_id.replace("new_","")+"_"+i,$field_val=o(t).val(),o(c).find("#"+$field_id).val($field_val),o(t).is(":checked")&&o(c).find("#"+$field_id).prop("checked",!0))}),o(document).trigger("yith-toggle-element-item-before-add",[t,c]),d.find(".yith-toggle-row").length?o(c).insertAfter(d.find(".yith-toggle-row").last()):o(c).appendTo(d.find("td")),o(document.body).trigger("wc-enhanced-select-init"),saveHolidayElement(c,n),o(t).toggle())}),o(document).on("click","#yith_delivery_date_panel_general-calendar .yith-toggle-row .yith-save-button",function(e){e.preventDefault();o(this).closest(".toggle-element");var t=o(this).closest(".yith-toggle-row"),a=t.find(".spinner");t.checkRequiredFields()&&(a.addClass("show"),updateHolidayElement(t,a))}),o(document).on("click","#yith_delivery_date_panel_general-calendar .yith-toggle-onoff",function(e){e.preventDefault();o(this).closest(".toggle-element");var t=o(this).closest(".yith-toggle-row");updateHolidayElement(t)}),o(document).on("click","#yith_delivery_date_panel_general-calendar .yith-toggle-row .yith-delete-button",function(e){e.preventDefault();o(this).closest(".toggle-element");var t=o(this).closest(".yith-toggle-row");t.remove(),deleteHolidayElement(t)}),o(document).on("change","#yith_delivery_date_panel_general-calendar :input.yith-required-field",function(e){var t=o(this).val();""===t&&null===t||(o(this).hasClass("wc-enhanced-select")?o(this).parent().find(".select2.select2-container").removeClass("ywcdd_required_field"):o(this).removeClass("ywcdd_required_field"))}),render_calendar(),init_datepicker(),o(document).on("yith-add-box-button-toggle",function(e,t){init_datepicker()})});