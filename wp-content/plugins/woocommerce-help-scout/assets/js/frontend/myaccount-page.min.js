!function(e){"use strict";e(function(){function o(o){o&&e.blockUI({message:o,baseZ:99999,overlayCSS:{background:"#fff",opacity:.6},css:{padding:"20px",zindex:"9999999",textAlign:"center",color:"#555",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait",lineHeight:"24px"}})}e("#support-conversations-table .conversation-view").on("click",function(r){r.preventDefault(),e("#support-conversation-wrap").show(),e("#support-conversation-wrap-reply").hide();var a=e(this).data("conversation-id"),c=e("#support-conversation-wrap"),t=e(this).data("subject");o(woocommerce_help_scout_myaccount_params.getting_conversation),e.ajax({type:"GET",url:woocommerce_help_scout_myaccount_params.ajax_url,cache:!1,dataType:"json",data:{action:"wc_help_scout_get_conversation",security:woocommerce_help_scout_myaccount_params.security,conversation_id:a},success:function(o){var r="",s=woocommerce_help_scout_myaccount_params.error;e.unblockUI(),null!==o&&""===o.error?(r+='<h3 id="support-conversation-thread-head">"'+t+'":</h3>',r+='<ul id="support-conversation-thread">',e.each(o.threads,function(e,o){r+="<li>",r+="<strong>"+o.author+"</strong> <small>("+o.date+")</small>:",r+=o.message,r+="</li>"}),r+="</ul>",r+='<p><a href="#" data-conversation-id="'+a+'" data-subject="'+t+'" class="button conversation-reply">'+woocommerce_help_scout_myaccount_params.reply+"</a></p>",c.empty().prepend(r),function(){var o=e("#support-conversation-wrap");e("html, body").animate({scrollTop:o.offset().top},500)}()):(null!==o&&null!==o.error&&""!==o.error&&(s=o.error),e(".woocommerce-error",c).remove(),c.prepend('<div class="woocommerce-error">'+s+"</div>"))},error:function(){e.unblockUI(),e(".woocommerce-error",c).remove(),c.prepend('<div class="woocommerce-error">'+woocommerce_help_scout_myaccount_params.error+"</div>")}})}),e("body").on("click",".conversation-reply",function(o){o.preventDefault(),e("#support-conversation-wrap").hide();var r,a=e(this).data("subject"),c=e(this).data("conversation-id");e("#support-conversation-wrap-reply").fadeOut(500,function(){e("#support-conversation-thread-head-reply").html(woocommerce_help_scout_myaccount_params.reply_to+" "+a),e("#reply_conversation_id").val(c),e("#reply_user_id").val(woocommerce_help_scout_myaccount_params.user_id),e("#reply_submit_btn").val(woocommerce_help_scout_myaccount_params.send),e(this).show(),e(".woocommerce-message").remove(),e("#support-conversation-reply").show()}),r=e("#support-conversation-wrap-reply"),e("html, body").animate({scrollTop:r.offset().top},500)}),e("body").on("submit","#support-conversation-reply",function(r){if(r.preventDefault(),e("#my-account-conversation-file-1").plupload("getFiles").length>0)e("#my-account-conversation-file-1").on("complete",function(){var r=e("#support-conversation-wrap-reply"),a=e("#support-conversation-reply"),c=e("#support-conversation-thread-head-reply");o(woocommerce_help_scout_myaccount_params.processing),e.ajax({type:"POST",url:woocommerce_help_scout_myaccount_params.ajax_url,cache:!1,dataType:"json",data:{conversation_id:e('input[name="conversation_id"]',a).val(),conversation_message:e('textarea[name="conversation_message"]',a).val(),user_id:e('input[name="user_id"]',a).val(),uploaded_files:e('input[name="uploaded_files"]',a).val(),action:"wc_help_scout_create_thread",security:woocommerce_help_scout_myaccount_params.security},success:function(o){e("#support-conversation-reply")[0].reset(),e("#my_account_conversation_uploaded_files_1").val(""),e("#support-conversation-reply").hide(),e("#plUploadArea").empty();if(e("#plUploadArea").html('<div id="my-account-conversation-file-1" class="pluploder-ui-input"><p>Your browser doesn\'t have Flash, Silverlight or HTML5 support.</p></div>'),e("#my-account-conversation-file-1").plupload({runtimes:"html5,flash,silverlight,html4",url:woocommerce_help_scout_form_params.ajax_url+"?action=wc_help_scout_upload_attachments",max_file_count:20,chunk_size:"1mb",filters:{max_file_size:"1000mb",mime_types:[{title:"Image files",extensions:"jpg,gif,png,jpeg"},{title:"Pdf files",extensions:"pdf"}]},rename:!0,sortable:!0,dragdrop:!0,views:{list:!0,thumbs:!0,active:"thumbs"},init:{FileUploaded:function(o,r,a){console.log(r.name);var c=e("#my_account_conversation_uploaded_files_1").val();""!=c?e("#my_account_conversation_uploaded_files_1").val(c+","+r.name):e("#my_account_conversation_uploaded_files_1").val(r.name)}}}),e.unblockUI(),null!==o&&1===o.error)e(".woocommerce-error",r).remove(),c.after('<div class="woocommerce-message">'+o.message+"</div>");else{var a=woocommerce_help_scout_myaccount_params.error;null!==o&&null!==o.message&&""!==o.message&&(a=o.message),e(".woocommerce-error",r).remove(),c.after('<div class="woocommerce-error">'+a+"</div>")}},error:function(){e.unblockUI(),e(".woocommerce-error",r).remove(),c.after('<div class="woocommerce-error">'+woocommerce_help_scout_myaccount_params.error+"</div>")}})}),e("#my-account-conversation-file-1").plupload("start");else{var a=e("#support-conversation-wrap-reply"),c=e("#support-conversation-reply"),t=e("#support-conversation-thread-head-reply");o(woocommerce_help_scout_myaccount_params.processing),e.ajax({type:"POST",url:woocommerce_help_scout_myaccount_params.ajax_url,cache:!1,dataType:"json",data:{conversation_id:e('input[name="conversation_id"]',c).val(),conversation_message:e('textarea[name="conversation_message"]',c).val(),user_id:e('input[name="user_id"]',c).val(),uploaded_files:e('input[name="uploaded_files"]',c).val(),action:"wc_help_scout_create_thread",security:woocommerce_help_scout_myaccount_params.security},success:function(o){if(e("#support-conversation-reply")[0].reset(),e("#support-conversation-reply").hide(),e.unblockUI(),null!==o&&1===o.error)e(".woocommerce-error",a).remove(),t.after('<div class="woocommerce-message">'+o.message+"</div>");else{var r=woocommerce_help_scout_myaccount_params.error;null!==o&&null!==o.message&&""!==o.message&&(r=o.message),e(".woocommerce-error",a).remove(),t.after('<div class="woocommerce-error">'+r+"</div>")}},error:function(){e.unblockUI(),e(".woocommerce-error",a).remove(),t.after('<div class="woocommerce-error">'+woocommerce_help_scout_myaccount_params.error+"</div>")}})}return!1})})}(jQuery);