function gwcpIsCustomQtyFieldMatch(t,i,n){if(!isNaN(parseInt(n.fieldId)))return t;var e=/(quantity)_([0-9]+)/.exec(n.fieldId);if(!e||"quantity"!=e[1])return t;var r=gformGetProductQuantity(i,e[2]);return gf_matches_operation(r+"",n.value,n.operator)}!function(_){window.GWConditionalPricing=function(t,i,n){var a=this;return a._formId=t,a._pricingLogic=i,a._basePrices=n,a._triggerTimer={},this.pricingIteration=0,this.init=function(){var i,n=this,t=GWConditionalPricing.getFormElement(this._formId),e=["select","input:not( .ginput_total + input )","textarea"].join(", "),r=['input[type="checkbox"]','input[type="radio"]','input[type="number"]'].join(", "),o=['input[type="text"]','input[type="hidden"]','input[type="number"]',"textarea"].join(", ");t.on("click",r,function(t){var i=gform.applyFilters("gpcp_update_pricing_delay",100,n,_(this));a.debouncedUpdatePricing(n.getFieldIdFromHtmlId(_(this).attr("id")),i)}).on("change",e,function(t){a.debouncedUpdatePricing(n.getFieldIdFromHtmlId(_(this).attr("id")),100)}).on("keyup",o,function(t){clearTimeout(i),i=setTimeout(function(){a.updatePricing(n.getFieldIdFromHtmlId(_(this).attr("id")))},300)}),gform.addFilter("gform_is_value_match","gwcpIsCustomQtyFieldMatch"),t.data("gwcp",n),n.updatePricing()},GWConditionalPricing.getFormElement=function(t){var i=_(gform.applyFilters("gpcp_form_element","#gform_wrapper_"+t));return i.length<=0&&(i=_("#gform_"+t)),i},a.debouncedUpdatePricing=function(t,i){clearTimeout(a._triggerTimer[t]),a._triggerTimer[t]=setTimeout(function(){a.updatePricing(t)},i)},this.updatePricing=function(t){this.pricingIteration++;var i=!t;for(var n in this._pricingLogic)if(this._pricingLogic.hasOwnProperty(n)){var e=this._pricingLogic[n];if(e&&null!==e[0]){var r=parseInt(n)==t,o=this.isDependency(t,e);if(i||r||o){for(var a=!1,c=0;c<e.length;c++){var u=e[c];if(this.isMatch(this._formId,u.conditionalLogic)){a=!0,GWConditionalPricing.setPrice(n,u.price,this._formId);break}}a||GWConditionalPricing.setPrice(n,!1,this._formId)}}}gform.doAction("gpcp_after_update_pricing",t,this),gformCalculateTotalPrice(this._formId)},this.isMatch=function(t,i){return"show"==gf_get_field_action(t,i)},GWConditionalPricing.setPrice=function(c,u,t){var l=GWConditionalPricing.getFormElement(t).data("gwcp"),g=new Currency(gf_global.gf_currency_config),d=parseInt(c),i=GWConditionalPricing.getProductInput(c,t),p=1<i.length,s=!1===u,f=u;if(!i)return!1;var h=null;i.each(function(t){var i=_(this),n=i.val(),e="",r=!1;if(s){var o=p?c+"."+(t+1):c;f=g.toNumber(l.getBasePrice(o))}if(!1!==(u=gform.applyFilters("gpcp_price",f,{productId:c,isReset:s,input:i,gwcp:l,currency:g}))){if(u=g.toNumber(u),i.is("option")||i.is(":radio")){if("|"==i.val())return;e=i.val().split("|")[0]+"|"+u,r=i.is(":selected, :checked"),i.val(e)}else{e=u,r=!0,i.val(g.toMoney(u,!0));var a="_"+l._formId+"_"+d;_("span#input"+a).text(g.toMoney(u,!0))}-1==n.indexOf("|")&&(n=g.toNumber(n)),e!=n&&r&&(null==h?h=i:h.add(i))}}),_(h).change()},GWConditionalPricing.getProductInput=function(t,i){var n=parseInt(t),e="_"+i+"_"+n,r=(t=t.toString(),_("#ginput_base_price"+e));if(r.length<=0){var o=n==t,a=t.split(".")[1]-1;(r=_("#input"+e)).is("ul")?o?r=r.find('input[type="radio"]'):(r=r.find("#choice_"+i+"_"+n+"_"+a)).length<=0&&(r=_("#input"+e+" #choice_"+n+"_"+a)):(r=r.find("option:not( .gf_placeholder )"),o||(r=r.eq(a)))}return!(r.length<=0)&&r},this.getFieldIdFromHtmlId=function(t){if(!t)return!1;var i=t.split("_");return"quantity"==i[1]?i[i.length-1]:"choice"==i[0]||4==i.length?i[i.length-2]:i[i.length-1]},this.getBasePrice=function(t){return this._basePrices[t]},GWConditionalPricing.getProductQuantity=function(t,i){var n,e=_("#ginput_quantity_"+i+"_"+t);return 0<e.length?n=gformIsNumber(e.val())?e.val():0:(quantityElement=_(".gfield_quantity_"+i+"_"+t),n=1,0<quantityElement.find("input").length?n=quantityElement.find("input").val():0<quantityElement.find("select").length&&(n=quantityElement.find("select").val()),gformIsNumber(n)||(n=0)),0<(n=parseFloat(n))&&(_anyProductSelected=!0),n},this.isDependency=function(t,i){for(var n=0;n<i.length;n++)for(var e=0;e<i[n].conditionalLogic.rules.length;e++){var r=i[n].conditionalLogic.rules[e].fieldId;if(parseInt(r)==parseInt(t))return!0;if(-1!=r.indexOf("quantity")&&r.split("_")[1]==t)return!0}return!1},GWConditionalPricing.hasPlaceholder=function(t,i){},this.init()}}(jQuery);
//# sourceMappingURL=gwconditionalpricing.js.map