function gwcpIsCustomQtyFieldMatch(i,t,n){if(!isNaN(parseInt(n.fieldId)))return i;var e=/(quantity)_([0-9]+)/.exec(n.fieldId);if(!e||"quantity"!=e[1])return i;var r=gformGetProductQuantity(t,e[2]);return gf_matches_operation(r+"",n.value,n.operator)}!function(m){window.GWConditionalPricing=function(d,i,t){var r=this;return r._formId=d,r._pricingLogic=i,r._basePrices=t,this.pricingIteration=0,this.init=function(){var i=GWConditionalPricing.getFormElement(this._formId),t=["select","input:not( .ginput_total + input ):not( .ginput_total )","textarea"].join(", "),n=['input[type="checkbox"]','input[type="radio"]','input[type="number"]'].join(", "),e=['input[type="text"]','input[type="hidden"]','input[type="number"]',"textarea"].join(", ");i.on("click",n,r.debouncedUpdatePricing).on("change",t,r.debouncedUpdatePricing).on("keyup",e,r.debouncedUpdatePricing),gform.addFilter("gform_is_value_match","gwcpIsCustomQtyFieldMatch"),m(document).on("gform_post_conditional_logic",function(i,t){parseInt(t)===r._formId&&r.debouncedUpdatePricing()}),i.data("gwcp",this),this.updatePricing()},GWConditionalPricing.getFormElement=function(i){var t=m(gform.applyFilters("gpcp_form_element","#gform_wrapper_"+i));return t.length<=0&&(t=m("#gform_"+i)),t},r.debouncedUpdatePricing=function(t,n,e){var r,o,a,c,l;function u(){var i=Date.now()-c;i<n&&0<=i?r=setTimeout(u,n-i):(r=null,e||(l=t.apply(a,o),a=o=null))}null==n&&(n=100);var i=function(){a=this,o=arguments,c=Date.now();var i=e&&!r;return r||(r=setTimeout(u,n)),i&&(l=t.apply(a,o),a=o=null),l};return i.clear=function(){r&&(clearTimeout(r),r=null)},i.flush=function(){r&&(l=t.apply(a,o),a=o=null,clearTimeout(r),r=null)},i}(function(){r.updatePricing()},50),this.updatePricing=function(i){this.ruleCache[d]={},this.pricingIteration++;var t=!i;for(var n in this._pricingLogic)if(this._pricingLogic.hasOwnProperty(n)){var e=this._pricingLogic[n];if(e&&null!==e[0]){var r=parseInt(n)==i,o=this.isDependency(i,e);if(t||r||o){for(var a=!1,c=0;c<e.length;c++){var l=e[c];if(this.isMatch(this._formId,l.conditionalLogic)){a=!0,GWConditionalPricing.setPrice(n,l.price,this._formId);break}}a||GWConditionalPricing.setPrice(n,!1,this._formId)}}}if(window.gf_global.gfcalc){var u=window.gf_global.gfcalc[d];u&&u.runCalcs(d,u.formulaFields)}gform.doAction("gpcp_after_update_pricing",i,this),gformCalculateTotalPrice(this._formId)},this.ruleCache={},this.isMatch=function(i,t){if(!t)return!0;i in this.ruleCache||(this.ruleCache[i]={});for(var n=0,e=0;e<t.rules.length;e++){var r=m.extend({},t.rules[e]),o=gf_get_field_number_format(r.fieldId,i,"value");o&&(r.value=gf_format_number(r.value,o));var a=JSON.stringify(r),c="#input_{0}_{1}".format(i,r.fieldId),l="is_hidden:"+c,u=m(c);l in this.ruleCache[i]||(this.ruleCache[i][l]=gformIsHidden(u)&&"hidden"!==u.prop("type")),this.ruleCache[i][l]||(a in this.ruleCache[i]||(this.ruleCache[i][a]=gf_is_match(i,r)),this.ruleCache[i][a]&&n++)}return"show"==("all"==t.logicType&&n==t.rules.length||"any"==t.logicType&&0<n?t.actionType:"show"==t.actionType?"hide":"show")},GWConditionalPricing.setPrice=function(c,l,u){var d=GWConditionalPricing.getFormElement(u).data("gwcp"),g=new Currency(gf_global.gf_currency_config),s=parseInt(c),i=GWConditionalPricing.getProductInput(c,u),p=1<i.length,f=!1===l,h=l;if(!i)return!1;var _=null;i.each(function(i){var t=m(this),n=t.val(),e="",r=!1,o=p?c+"."+(i+1):c;if(f&&(h=g.toNumber(d.getBasePrice(o))),!1!==(l=gform.applyFilters("gpcp_price",h,{productId:c,isReset:f,input:t,inputId:o,gwcp:d,currency:g,formId:u}))){if(l=g.toNumber(l),t.is("option")||t.is(":radio")){if("|"==t.val())return;e=t.val().split("|")[0]+"|"+l,r=t.is(":selected, :checked"),t.val(e)}else{e=l,r=!0,t.val(g.toMoney(l,!0));var a="_"+d._formId+"_"+s;m("span#input"+a).text(g.toMoney(l,!0))}-1==n.indexOf("|")&&(n=g.toNumber(n)),e!=n&&r&&(null==_?_=t:_.add(t))}}),m(_).change()},GWConditionalPricing.getProductInput=function(i,t){var n=parseInt(i),e="_"+t+"_"+n,r=(i=i.toString(),m("#ginput_base_price"+e));if(r.length<=0){var o=n==i,a=i.split(".")[1]-1;(r=m("#input"+e)).is("ul")||r.is("div")?o?r=r.find('input[type="radio"]'):(r=r.find("#choice_"+t+"_"+n+"_"+a)).length<=0&&(r=m("#input"+e+" #choice_"+n+"_"+a)):(r=r.find("option:not( .gf_placeholder )"),o||(r=r.eq(a)))}return!(r.length<=0)&&r},this.getFieldIdFromHtmlId=function(i){if(!i)return!1;var t=i.split("_");return"quantity"==t[1]?t[t.length-1]:"choice"==t[0]||4==t.length?t[t.length-2]:t[t.length-1]},this.getBasePrice=function(i){return this._basePrices[i]},GWConditionalPricing.getProductQuantity=function(i,t){var n,e=m("#ginput_quantity_"+t+"_"+i);return 0<e.length?n=gformIsNumber(e.val())?e.val():0:(quantityElement=m(".gfield_quantity_"+t+"_"+i),n=1,0<quantityElement.find("input").length?n=quantityElement.find("input").val():0<quantityElement.find("select").length&&(n=quantityElement.find("select").val()),gformIsNumber(n)||(n=0)),0<(n=parseFloat(n))&&(_anyProductSelected=!0),n},this.isDependency=function(i,t){for(var n=0;n<t.length;n++)for(var e=0;e<t[n].conditionalLogic.rules.length;e++){var r=t[n].conditionalLogic.rules[e].fieldId;if(parseInt(r)==parseInt(i))return!0;if(-1!=r.indexOf("quantity")&&r.split("_")[1]==i)return!0}return!1},GWConditionalPricing.hasPlaceholder=function(i,t){},this.init()}}(jQuery);
//# sourceMappingURL=gwconditionalpricing.js.map