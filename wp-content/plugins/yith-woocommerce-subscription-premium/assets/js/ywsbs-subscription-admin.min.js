jQuery(function(a){a("#ywsbs_safe_submit_field").val(""),a("#ywsbs_schedule_subscription_button").on("click",function(s){s.preventDefault(),a("#ywsbs_safe_submit_field").val("schedule_subscription"),a(this).closest("form").submit()}),0<a(document).find(".wp-heading-inline").length&&a('<div class="view-all-subs"><a href="'+ywsbs_subscription_admin.url_back_to_all_subscription+'"> < '+ywsbs_subscription_admin.back_to_all_subscription+"</a></div>").insertBefore(".wp-heading-inline"),a(document).on("click","a.edit_address",function(s){s.preventDefault();var i=a(this),e=i.closest(".subscription_data_column").find("div.edit_address"),t=i.closest(".subscription_data_column").find("a");i.closest(".subscription_data_column").find("div.address").toggle(),t.toggle(),e.toggle()});a(document).on("click",".load_customer_info",function(s){s.preventDefault();var i=a(this);!function(i,e,s){var t=i===e?"load_"+i:"copy_billing";if(!0===s||window.confirm(ywsbs_subscription_admin[t])){var n=a("#user_id").val();if(0===n)return window.alert(ywsbs_subscription_admin.no_customer_selected);var o={user_id:n,action:"woocommerce_get_customer_details",security:ywsbs_subscription_admin.get_customer_details_nonce};a.ajax({url:ywsbs_subscription_admin.ajaxurl,data:o,type:"POST",success:function(s){console.log(s),s&&s[i]&&a.each(s[i],function(s,i){a("#_"+e+"_"+s).val(i).change()})}})}}(i.data("from"),i.data("to"))}),a.fn.datetimepicker!==undefined&&a(document).find(".ywsbs-timepicker").each(function(){a(this).prop("placeholder","YYYY-MM-DD HH:mm")}).datetimepicker({timeFormat:"HH:mm:ss",defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showSeconds:!1}),a(document).find(".ui-datepicker").addClass("yith-plugin-fw-datepicker-div"),a("#ywsbs_schedule_subscription_button").on("click",function(s){s.preventDefault(),a("#ywsbs_safe_submit_field").val("schedule_subscription"),a(this).closest("form").submit()});var i={init:function(){var s=a(document).find("#woocommerce-order-items");s.on("click","a.edit-order-item",this.edit_item),s.on("click",".save-action",this.save_items),s.on("click",".recalculate-action",this.recalculate)},edit_item:function(){return a(this).closest("tr").find(".view").hide(),a(this).closest("tr").find(".edit").show(),a(this).hide(),a(".wc-order-add-item").show(),a(".wc-order-recalculate").hide(),a("button.cancel-action").attr("data-reload",!0),!1},save_items:function(){var s={subscription_id:a("#post_ID").val(),items:a("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),action:"ywsbs_save_items",security:ywsbs_subscription_admin.save_item_nonce};return a.ajax({url:ywsbs_subscription_admin.ajaxurl,data:s,type:"POST",beforeSend:function(){a("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(s){a("#ywsbs-product-subscription").find(".inside").empty().append(s),a("#woocommerce-order-items").unblock(),i.init()}}),!1},recalculate:function(){var s={subscription_id:a("#post_ID").val(),action:"ywsbs_recalculate",security:ywsbs_subscription_admin.recalculate_nonce};a.ajax({url:ywsbs_subscription_admin.ajaxurl,data:s,type:"POST",beforeSend:function(){a("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(s){a("#ywsbs-product-subscription").find(".inside").empty().append(s),a("#woocommerce-order-items").unblock(),i.init()}})}};function t(){return a(document).find(".ywsbs-delivery-schedules-table").DataTable({searching:!0,ordering:!1,language:{lengthMenu:ywsbs_subscription_admin.datatable_lengthMenu+" _MENU_"}})}i.init(),0<a(".ywsbs-export").length&&(a(".wp-header-end").before(a(".ywsbs-export")),a(".ywsbs-export").css({display:"inline-block"}));var n=t();a(document).on("change","#ywsbs-delivery-schedules-status",function(){n.columns(1).search(this.value).draw()});var r=function(s,e){a.ajax({url:ywsbs_subscription_admin.ajaxurl,data:s,type:"POST",beforeSend:function(){e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(s){if("undefined"==typeof s.error){var i=a("#ywsbs-delivery-schedules-status").val();e.unblock(),e.closest(".inside").html(s),n.destroy,n=t(),i&&a("#ywsbs-delivery-schedules-status").val(i).change()}}})};a(document).on("change",".status-hover",function(){var s=a(this),i=s.val(),e=s.closest(".status-td"),t=e.data("id"),n=a("#yith-shipped-confirm"),o={action:"ywsbs_update_delivery_status",security:ywsbs_subscription_admin.delivery_nonce,deliveryID:t,status:i,subscriptionID:a("#post_ID").val()},c={};c[ywsbs_subscription_admin["continue"]]=function(){r(o,e),n.dialog("close")},c[ywsbs_subscription_admin.cancel]=function(){n.dialog("close")},"shipped"===i?n.dialog({width:450,modal:!0,dialogClass:"ywsbs-shipped-confirm",buttons:c}):r(o,e)}),a(document).on("click",".remove-coupon",function(){var s=a(this),i=s.data("code");a("#ywsbs-product-subscription").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={action:"ywsbs_remove_subscription_coupon",dataType:"json",subscription_id:a("#post_ID").val(),security:s.data("nonce"),coupon:i};a.post(ywsbs_subscription_admin.ajaxurl,e,function(s){s.success?a("#ywsbs-product-subscription").find(".inside").empty().append(s.data.html):window.alert(s.data.error),a("#ywsbs-product-subscription").unblock()})}),a(document).on("click",".add-coupon",function(){var s=a(this),i=window.prompt(ywsbs_subscription_admin.add_coupon_text);if(null!==i){a("#ywsbs-product-subscription").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={action:"ywsbs_add_subscription_coupon",dataType:"json",subscription_id:a("#post_ID").val(),security:s.data("nonce"),coupon:i.trim(),user_id:a("#user_id").val(),user_email:a("#_billing_email").val()};a.post(ywsbs_subscription_admin.ajaxurl,e,function(s){s.success?a("#ywsbs-product-subscription").find(".inside").empty().append(s.data.html):window.alert(s.data.error),a("#ywsbs-product-subscription").unblock()})}return!1})});