jQuery(function(e){var t=e("#woocommerce-pinterest-catalog-updating-frequency-days").parents("tr"),o=e("#woocommerce_pinterest_enable_catalog_auto_updating");e(document).on("click","#regenerate_thumbnails",function(){let t=e(this);confirm(t.data("prompt"))&&e.ajax({url:window.ajaxurl,method:"GET",dataType:"json",data:{action:premmerceSettings.regenerate_shop_thumbnails,_ajax_nonce:premmerceSettings.get_google_categories_nonce},success:function(e){t.after('<div class="updated inline" style="margin-bottom:0"><p>'+e.message+"</p></div>")}})}),e(document).on("click","#start_create_and_set_up_boards",function(t){t.preventDefault();let o=e(this);confirm(o.data("prompt"))&&e.ajax({url:window.ajaxurl,method:"POST",dataType:"json",data:{action:premmerceSettings.create_and_set_up_boards,_ajax_nonce:premmerceSettings.get_google_categories_nonce},success:function(e){let t=o.parent().find(".boards-created-response").addClass(e.class);t.html(e.message).slideDown(),setTimeout(function(){t.slideUp(function(){t.removeClass(e.class)})},4e3)}})}),e(document).on("click","button[data-var]",function(){var t=e(this);!function(e,t){var o=document.querySelector(e);if(!o)return;o.focus();var n=o.value,r=o.selectionStart;o.value=n.slice(0,r)+t+n.slice(r),r+=t.length,o.setSelectionRange(r,r)}(t.data("field"),t.data("var"))}),e(document).on("change",".woocommerce-pinterest-google-category-select",function(t){var o=e(t.target),n=o.val();o.nextAll("select").remove(),o.is(":last-of-type")&&o.parent("fieldset").children(".woocommerce-pinterest-google-categories-mapping").val(n),""!==n&&e.ajax({url:window.ajaxurl,method:"GET",dataType:"json",data:{action:premmerceSettings.get_google_categories_action,parentId:n,_ajax_nonce:premmerceSettings.get_google_categories_nonce},success:function(t){if(t.length>0){var n=o.clone().val("").empty();n.append(new Option(premmerceSettings.not_selected_option_name)),e.each(t,function(e,t){n.append(new Option(t.name,t.id))}),n.insertAfter(o)}}})}),e(document).on("click",".woocommerce-pinterest-category-board-new-select",function(t){t.preventDefault();var o=e(t.target).parent("td").find("fieldset").find(".woocommerce-pinterest-board-select-container"),n=o.first().clone();n.find("select").val(""),n.find("input").val("");var r=o.last(),s=new RegExp("^([^\\[]+\\[\\d+]\\[)(\\d+)(]\\[board_id])"),a=parseInt(r.find("select").attr("name").match(s)[2])+1,i=n.find("select").attr("name");i=i.replace(s,function(e,t,o,n,r,s){return[t,a,n].join("")}),n.find("select").attr("name",i),n.insertAfter(r)}),e(document).on("click",".woocommerce-pinterest-remove-board-select",function(t){t.preventDefault(),e(this).parents(".woocommerce-pinterest-board-select-container").remove()});var n=e("#woocommerce_pinterest_tags_fetching_strategy");n.select2(),e("ul.select2-selection__rendered").sortable({containment:"parent",update:function(t){e(t.target).children("li[title]").each(function(t,o){n.children("option").each(function(){e(o);if(e(this).html()==o.title){var t=e(this),n=t.parent();t.detach(),n.append(t)}})}),n.trigger("change")}}),t.toggle(o.is(":checked")),o.on("change",function(){t.toggle()}),e(document).on("click",".woocommerce-pinterest-copy-catalog-url-button",function(){e(".woocommerce-pinterest-catalog-url-field").select(),document.execCommand("copy")}),e("[name=woocommerce_pinterest_pin_time]").on("change",function(t){var o=[e("#woocommerce_pinterest_pin_defer_day").closest("tr"),e("#woocommerce_pinterest_pin_defer_time").closest("tr"),e("#woocommerce_pinterest_pin_defer_interval").closest("tr")];e("[name=woocommerce_pinterest_pin_defer_interval]").trigger("change"),"defer"===e(this).val()?o.forEach(function(e){e.show()}):o.forEach(function(e){e.hide()})}).trigger("change"),e("[name=woocommerce_pinterest_pin_defer_interval]").on("change",function(t){var o=[e("#woocommerce_pinterest_pin_defer_pins_per_interval").closest("tr"),e("#woocommerce_pinterest_pin_defer_pins_per_day").closest("tr")];"-1"===e(this).val()||"defer"!==e("[name=woocommerce_pinterest_pin_time]").val()?o.forEach(function(e){e.hide()}):o.forEach(function(e){e.show()})}).trigger("change"),e("[name=woocommerce_pinterest_pinterest_image_size_type]").on("change",function(t){var o=e("#pinterest_image_size-field");"pinterest_image"===e(this).val()?o.show():o.hide()}).trigger("change"),e(document).on("click","h3.wc-settings-sub-title",function(t){var o=e(this).toggleClass("closed"),n=o.prop("id").replace("woocommerce_pinterest_",""),r=o.hasClass("closed");e.ajax({url:window.ajaxurl,method:"POST",dataType:"json",data:{action:premmerceSettings.update_settings_page_boxes_states_action,sectionId:n,closed:r,_ajax_nonce:premmerceSettings.update_settings_page_boxes_states_nonce}})}),e("#start_pin_all_process_button").on("click",function(t){if(t.preventDefault(),confirm("Are you sure you want to pin product images according to the Pinterest boards settings? Non-boarded products will be skipped?")){var o=e("#woocommerce_pinterest_pin_all_images").prop("checked")?1:0;window.location=e(this).data("url")+"&pin_all_gallery_images="+o}});var r=function(t){this.element=e(t),this.interval=null,this.init=function(){this.element.length&&(this.interval=setInterval(this.update.bind(this),2e3))},this.update=function(){e.ajax({url:ajaxurl,data:{action:this.element.data("action"),nonce:this.element.data("nonce")}}).done(function(e){if(e.error&&(alert(error),window.location.reload()),e.process_status)if("pending"===e.process_status.status)this.element.closest("tr").css("display","none"),clearInterval(this.interval);else if("processing"===e.process_status.status){this.element.closest("tr").css("display","table-row");var t=e.process_status.processing_category;if(void 0!==t.products_total&&void 0!==t.name&&void 0!==t.products_processed){var o=parseInt(t.products_total),n=parseInt(t.products_processed),r=(n=isNaN(n)?0:n)/(o/100),s=Math.round(s);this.setCategoryName(t.name),this.setProcessedProductCounts(n),this.setTotalProductCounts(o),this.setPercentagePart(r),this.setProgress(Math.min(100,r))}}}.bind(this))},this.setProgress=function(e){this.element.find("progress").val(e)},this.setCategoryName=function(e){this.element.find(".woocommerce-importer-progress__category").text(e)},this.setProcessedProductCounts=function(e){this.element.find(".woocommerce-importer-progress__pushed").text(e)},this.setTotalProductCounts=function(e){this.element.find(".woocommerce-importer-progress__total").text(e)},this.setPercentagePart=function(e){this.element.find(".woocommerce-importer-progress__percents").text(e)}};e(document).ready(function(){new r(".woocommerce-importer-progress").init(),jQuery("#woocommerce_pinterest_board").selectWoo(),jQuery(".woocommerce-pinterest-category-board-relations").selectWoo()})});