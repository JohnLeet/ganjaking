"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,l=new Array(e.length);t<e.length;t++)l[t]=e[t];return l}}jQuery(function(o){var e=Object.assign(document.createElement("style"),{id:"label-style"});document.head.appendChild(e);var r=document.querySelector(".product-label"),n=document.querySelector(".label-wrap"),u=document.querySelector("#_wapl_label_type"),c=document.querySelector("#_wapl_label_text"),s=document.querySelector("#_wapl_label_style"),t=document.querySelector("#_wapl_label_align"),i=document.querySelector("#wapl-custom-position-left"),p=document.querySelector("#wapl-custom-position-top"),d=document.querySelector(".wapl-meta-box, #woocommerce_advanced_product_labels");if(r){u.addEventListener("change",m),m(),s.addEventListener("input",y),y(),c.addEventListener("input",b),t.addEventListener("change",f),f(),v(),i.addEventListener("change",g),p.addEventListener("change",g),document.body.addEventListener("keydown",function(e){var t=document.activeElement,l=e.shiftKey?10:1,a=r.style.left||r.offsetLeft,o=r.style.top||r.offsetTop;if(t&&-1!==["input","select","button","textarea"].indexOf(t.tagName.toLowerCase()))return!0;switch(e.keyCode||e.which){case 37:w(parseInt(a,10)-l);break;case 38:w(null,parseInt(o,10)-l);break;case 39:w(parseInt(a,10)+l);break;case 40:w(null,parseInt(o,10)+l);break;default:return!0}e.preventDefault()}),o("#wapl-custom-background").wpColorPicker({color:"#D9534F",palettes:!1,change:function(e,t){r.style.backgroundColor=t.color.toString(),document.querySelector("#label-style").innerHTML=".label-wrap .product-label:after { border-color: "+t.color.toString()+"; }"}}),o("#wapl-custom-text").wpColorPicker({color:"#fff",palettes:!1,change:function(e,t){r.style.color=t.color.toString()}});var l,a=wp.media.model.settings.post.id;o("#upload_image_button").on("click",function(e){if(e.preventDefault(),l)return l.uploader.uploader.param("post_id",0),void l.open();wp.media.model.settings.post.id=0,(l=wp.media.frames.file_frame=wp.media({title:"Select a image to upload",button:{text:"Use this image"},multiple:!1})).on("select",function(){var e=l.state().get("selection").first().toJSON();r.style.backgroundImage='url("'+e.url+'")',r.style.width=e.width+"px",r.style.height=e.height+"px",o("#custom-image-url").attr("value",e.url),o("#wapl-custom-image").val(e.id),_(),wp.media.model.settings.post.id=a}),l.open()}),o("a.add_media").on("click",function(){wp.media.model.settings.post.id=a})}function m(){var e,t,l=wapl.types.map(function(e){return"type-"+e}),a=u.value;(e=d.classList).remove.apply(e,_toConsumableArray(l)),d.classList.add("type-"+a),(t=n.classList).remove.apply(t,_toConsumableArray(wapl.types.map(function(e){return"wapl-"+e}))),n.classList.add("wapl-"+a),"custom"===a&&(c.value="",s.value="red",b(),y())}function y(e){var t,l,a;(t=r.classList).remove.apply(t,_toConsumableArray(wapl.colors.map(function(e){return"label-"+e}))),r.classList.add("label-"+s.value),(l=n.classList).remove.apply(l,_toConsumableArray(wapl.colors.map(function(e){return"label-"+e}))),n.classList.add("label-"+s.value),(a=d.classList).remove.apply(a,_toConsumableArray(wapl.colors.map(function(e){return"label-color-"+e}))),d.classList.add("label-color-"+s.value),"custom"!==s.value&&(r.style.backgroundColor="",r.style.color=""),"custom"===s.value&&"rgba(0, 0, 0, 0)"==function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,null).getPropertyValue(t)}(r,"background-color")&&(r.style.backgroundColor=document.querySelector("#wapl-custom-background").value,r.style.color=document.querySelector("#wapl-custom-text").value,document.querySelector("#label-style").innerHTML=".label-wrap .product-label:after { border-color: "+o("#wapl-custom-background").val()+"; }")}function b(){document.querySelector(".wapl-label-text").innerHTML=c.value}function f(e){"custom"===t.value?(d.classList.add("align-custom"),r.style.top=p.value+"px",r.style.left=i.value+"px",_()):(d.classList.remove("align-custom"),r.style.top=null,r.style.left=null),n.classList.remove("wapl-alignleft","wapl-alignright","wapl-aligncenter","wapl-aligncustom"),n.classList.add("wapl-align"+t.value)}function v(){var e=Math.round(r.style.left.replace("px","")),t=Math.round(r.style.top.replace("px",""));i.value=e,p.value=t}function g(){w(i.value,p.value)}function w(e,t){var l=0<arguments.length&&void 0!==e?e:null,a=1<arguments.length&&void 0!==t?t:null;null!==l&&(r.style.left=l+"px",i.value=l),null!==a&&(r.style.top=a+"px",p.value=a)}function _(){o(".product-label").draggable({create:v,stop:v,drag:v})}});