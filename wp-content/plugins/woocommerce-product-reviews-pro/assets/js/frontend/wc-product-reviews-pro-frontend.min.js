"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(function(){var f,e;function i(e){var t;_classCallCheck(this,i),this.initializeFilter=this.initializeFilter.bind(this),this.initializeRatingFilter=this.initializeRatingFilter.bind(this),this.filterContributions=this.filterContributions.bind(this),this.initializeTabs=this.initializeTabs.bind(this),this.activateTab=this.activateTab.bind(this),this.initializeAttachmentFields=this.initializeAttachmentFields.bind(this),this.initializeFieldToggler=this.initializeFieldToggler.bind(this),this.initializeValidation=this.initializeValidation.bind(this),this.initializeVoting=this.initializeVoting.bind(this),this.initializeNotifications=this.initializeNotifications.bind(this),this.initializeModal=this.initializeModal.bind(this),this.initializeFlagging=this.initializeFlagging.bind(this),this.handleModalAjaxResponse=this.handleModalAjaxResponse.bind(this),this.showModal=this.showModal.bind(this),this.hideModal=this.hideModal.bind(this),this.refreshNonce=this.refreshNonce.bind(this),this.initializeReviewEditing=this.initializeReviewEditing.bind(this),this.initializeReviewUpdating=this.initializeReviewUpdating.bind(this),this.checkReviewUpdated=this.checkReviewUpdated.bind(this),this.options=e,t=window.location.hash&&0===window.location.hash.indexOf("share")?window.location.hash.split("-")[1]:null,this.options.comment_type=this.options.comment_type||t,this.initializeModal(),this.initializeTabs(),this.initializeRadioButtons(),this.initializeAttachmentFields(),this.initializeRatingFields(),this.initializeFieldToggler(),this.initializeValidation(),this.initializeVoting(),this.initializeNotifications(),this.initializeFlagging(),this.initializeTips(),this.initializeFilter(),this.initializeRatingFilter(),this.initializeReviewEditing(),this.initializeDefaultReviewEditing(),this.initializeReviewUpdating(),this.checkReviewUpdated(),this.removeReviewAttachment(),this.emptyReviewAttchmentURL(),this.checkGuestSaveReview(),this.initializeGuestWatch(),this.submitGuestWatch()}f=jQuery,_createClass(i,[{key:"initializeFilter",value:function(){var i=this;return f(".contributions-filter select").on("change",function(e){var t=f(e.currentTarget);return i.filterContributions(t.val())}),f(".js-clear-filters").on("click",function(e){return e.preventDefault(),f(".contributions-filter select").val("").trigger("change")})}},{key:"initializeRatingFilter",value:function(){var i=this;return f("#reviews .product-rating-details a").on("click",function(e){var t;return e.preventDefault(),t=f(e.currentTarget),f(".contributions-filter select").val("comment_type=review"),i.filterContributions(decodeURIComponent(t.attr("href")).split("comments_filter=")[1].split("#")[0])})}},{key:"filterContributions",value:function(e){var t=this;return f("#contributions-list-title").text(this.options.i18n.loading),f("#contributions-list .contributions-container").empty().addClass("loading"),f.get(this.options.ajax_url,{action:"wc_product_reviews_pro_contributions_list",product_id:this.options.product_id,comments_filter:e},function(e){return f("#contributions-list").html(e),t.hideFlagForms(),t.initializeFieldToggler(),t.initializeTips()}),e?f(".js-clear-filters").show():f(".js-clear-filters").hide()}},{key:"initializeRadioButtons",value:function(){return f("#reviews").on("click",".form-contribution input[type='radio']",function(e){var t=e.currentTarget,i=f(t),n=i.closest(".form-row");if(!n.hasClass("validate-required"))return t.value===n.attr("data-prev-value")?(i.prop("checked",!1).trigger("change"),n.attr("data-prev-value","")):n.attr("data-prev-value",t.value)})}},{key:"initializeTabs",value:function(){var i=this;return this.$contributionTabs=f(".contribution-form-wrapper"),this.options.comment_type&&"contribution_comment"!==this.options.comment_type&&this.activateTab(this.options.comment_type),f(".js-switch-contribution-type").on("click",function(e){var t;return e.preventDefault(),t=f(e.currentTarget),i.activateTab(t.attr("href").split("-")[1])})}},{key:"activateTab",value:function(e){return this.$contributionTabs.removeClass("active"),this.$contributionTabs.filter("#"+e+"_form_wrapper").addClass("active"),f('.js-switch-contribution-type[href="#share-'+e+'"]').addClass("active").siblings(".active").removeClass("active")}},{key:"initializeRatingFields",value:function(){return f("#review_rating_field").each(function(e,t){var i=f(t),n=f('<span class="star-label" data-selected-text="" />');return i.append(n),i.find("label.checkbox").each(function(e,t){var i=f(t);return i.hover(function(){return n.text(i.text())},function(){return n.text(n.data("selected-text"))})}),i.find("input").on("change",function(){var e=f(this).siblings('label.checkbox[for="review_rating_'+f(this).val()+'"]').text();return n.text(e).data("selected-text",e)})})}},{key:"initializeAttachmentFields",value:function(){var l=this;return f(".form-contribution .attachment-url").each(function(e,t){var i=f(t),n=i.closest("form").find(".attachment-file");if(n.length)return i.add(n).prepend('<a href="#" class="toggle-attachment-source"></a>')}),f(".form-contribution .attachment-type").each(function(e,t){var r,n=f(t),i=n.closest("form"),a=i.find('input[name="comment_type"]').val(),o=n.find("input"),s=i.find(".attachment-url"),c=i.find(".attachment-file");return-1===f.inArray(a,["video","photo"])&&s.hide(),c.hide(),r=function(e){return s.find(".toggle-attachment-source").text(l.options.i18n["attach_"+e+"_file"]),c.find(".toggle-attachment-source").text(l.options.i18n["attach_"+e+"_url"])},o.val()&&r(o.val()),o.on("change",function(e){var t=e.currentTarget,i=f(t),n=t.value;return i.is(":checked")&&n?(r(n),"video"===n?(c.hide(),s.find(".toggle-attachment-source").hide()):s.find(".toggle-attachment-source").show(),s.is(":visible")||c.is(":visible")?void 0:s.slideDown("fast")):(s.slideUp("fast"),c.slideUp("fast"))}).each(function(e,t){var i;return n=f(t),i=t.value,n.next("label.checkbox").attr("title",l.options.i18n["attach_a_"+i]).addClass("js-tip")}),n.find("label:first-child").hide(),i.find(".toggle-attachment-source").on("click",function(e){return e.preventDefault(),c.slideToggle("fast"),s.slideToggle("fast")}),c.on("change","input",function(e){var t=e.currentTarget,i=f(t);if(i.siblings(".wc-product-reviews-pro-validation-error").remove(),!t.files[0].type.match("image.*"))return i.after('<span class="wc-product-reviews-pro-validation-error">'+l.options.i18n.file_not_allowed+"</span>")})})}},{key:"initializeFieldToggler",value:function(){var r=this;return f(".form-contribution:not(.field-toggler-initialized)").each(function(e,t){var i=f(t),n=i.find('input[name="comment_type"]').val();if(f(".star-rating-selector:not(.validate-required )").insertAfter("#review_comment_field"),r.options.comment_type!==n)return i.find(".form-row:not(:first)").hide(),i.find(".wc-product-reviews-pro-form-submit-row").hide(),i.find(".form-row:first").find("input, textarea, select").one("focus change",function(e){var t=f(e.currentTarget).closest("form"),i=t.find('input[name="comment_type"]').val();return"photo"!==i&&"video"!==i?(t.find(".form-row:hidden:not(:contains(.input-hidden)):not(.attachment-source)").slideDown("fast"),t.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden)):not(.attachment-source)").slideDown("fast")):"photo"===i?(t.find(".form-row:hidden:not(:contains(.input-hidden)):not(.attachment-file)").slideDown("fast"),t.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden)):not(.attachment-file)").slideDown("fast")):(t.find(".form-row:hidden:not(:contains(.input-hidden))").slideDown("fast"),t.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden))").slideDown("fast"))}),i.addClass("field-toggler-initialized")})}},{key:"initializeValidation",value:function(){var h=this;return f("#reviews").on("submit",".form-contribution",function(e){var t,u,i,d,n,p,r;if(e.preventDefault(),t=f(e.currentTarget),p=t.find('input[name="comment_type"]').val(),t.find(".wc-product-reviews-pro-validation-error").remove(),d=h.options.file_size_max,u=0,t.find("input,select,textarea").each(function(e,t){var i,n,r,a,o,s=f(t),c=s.attr("name"),l=s.val();switch(s.closest(".form-row").hasClass("validate-required")&&"review_rating"!==c&&!l&&(s.after('<span class="wc-product-reviews-pro-validation-error">'+h.options.i18n.error_required+"</span>"),u++),c){case p+"_comment":if(o=(i=s).data("min-word-count"),a=i.data("max-word-count"),o||a){if(n=f.trim(i.val()).split(" ").length,o&&n<o)return i.after('<span class="wc-product-reviews-pro-validation-error">'+h.options.i18n.error_too_short.replace(/%d/g,o)+"</span>"),u++;if(a&&a<n)return i.after('<span class="wc-product-reviews-pro-validation-error">'+h.options.i18n.error_too_long.replace(/%d/g,a)+"</span>"),u++}break;case p+"_attachment_file":if(r=null,"undefined"!=typeof FileReader&&null!==FileReader&&0<t.files.length&&(r=t.files[0].size),null!=r&&d<r)return s.after('<span class="wc-product-reviews-pro-validation-error">'+h.options.i18n.error_file_size_max+"</span>"),u++}}),"photo"===p&&(r=t.find(".attachment-url input").val(),i=t.find(".attachment-file input").val(),r||i||(t.find(".attachment-url input").after('<span class="wc-product-reviews-pro-validation-error">'+h.options.i18n.error_attach_file+"</span>"),t.find(".attachment-file input").after('<span class="wc-product-reviews-pro-validation-error">'+h.options.i18n.error_attach_file+"</span>"))),!u)return n=function(){return t.get(0).submit()},!h.options.is_user_logged_in&&h.options.comment_registration?(f(".guest-switcher").data("target","form-contribution"),f("#guest_login, .guest-switcher, .switcher .login").hide(),f("#customer_login, .switcher .register").show(),h.showModal().one("login",n)):n()})}},{key:"initializeVoting",value:function(){var l=this;return f("#comments").on("click",".contribution-actions .vote",function(e){var i,n,r,a,t,o,s,c;return e.preventDefault(),a=f(e.currentTarget),s=a.hasClass("vote-down")?"negative":"positive",o=a.data("comment-id"),i=a.siblings(".feedback").html(""),r=a.siblings(".vote-count-positive"),n=a.siblings(".vote-count-negative"),c=a.hasClass("done"),t=function(){return f.ajax({type:"POST",url:l.options.ajax_url,data:{action:"wc_product_reviews_pro_vote",security:l.options.nonce,vote:s,comment_id:o},success:function(e){var t;return i.css("display","inline-block"),setTimeout(function(){return i.fadeOut()},2e3),e.data&&e.data.message?(i.text(e.data.message),e.success?(i.removeClass("error"),r.text("("+e.data.positive_votes+")"),n.text("("+e.data.negative_votes+")"),a.removeClass("done").siblings(".vote").removeClass("done"),c||a.addClass("done"),t=e.data.positive_votes||e.data.negative_votes?l.options.i18n.comment_karma.replace("%1$d",e.data.positive_votes).replace("%2$d",e.data.total_votes):"",a.closest(".comment_container").find(".contribution-karma").text(t)):i.addClass("error")):i.text(l.options.i18n.vote_failed).addClass("error")}})},l.options.is_user_logged_in?t():(f(".guest-switcher").data("target","vote"),f("#guest_login, .guest-switcher, .switcher .login").hide(),f("#customer_login, .switcher .register").show(),l.showModal().one("login",t))})}},{key:"initializeNotifications",value:function(){var o=this;return f("#comments").on("click",".contribution-actions .notifications",function(e){var t,i,n,r,a;return e.preventDefault(),i=f(e.currentTarget),a=i.hasClass("subscribe")?"subscribe":"unsubscribe",n=i.data("comment-id"),t=i.siblings(".feedback").html(""),r=function(){return f.ajax({type:"POST",url:o.options.ajax_url,data:{action:"wc_product_reviews_pro_notify_replies",security:o.options.nonce,manage:a,user_id:o.options.user_id,comment_id:n},success:function(e){return t.css("display","inline-block"),setTimeout(function(){return t.fadeOut()},2e3),e.data&&e.data.message?(t.text(e.data.message),e.success?(i.hide(),"subscribe"==a?i.parent().find(".unsubscribe").show():i.parent().find(".subscribe").show(),t.removeClass("error")):t.addClass("error")):t.text(o.options.i18n.subscribe_failed).addClass("error")}})},o.options.is_user_logged_in?r():(f(".guest-switcher").data("target","notification"),f("#guest_login, .switcher .login").hide(),f("#customer_login, .guest-switcher, .switcher .register").show(),f("#guest-comment-id").val(n),o.showModal().one("login",r))})}},{key:"initializeModal",value:function(){var t,n=this;return this.$modal=t=f("#wc-product-reviews-pro-modal"),this.$overlay=f("#wc-product-reviews-pro-modal-overlay"),this.$modalContainer=f("#wc-product-reviews-pro-modal-container"),t.find("a.close").on("click",function(e){return e.preventDefault(),n.hideModal()}),t.find(".switcher a").on("click",function(e){return e.preventDefault(),f(e.currentTarget).closest(".switcher").find("p").toggle(),t.find(".col-1, .col-2").toggle().filter(":visible").find(".woocommerce-Input").first().focus()}),t.find("form.login").on("submit",function(e){var t,i;return e.preventDefault(),i=(t=f(e.currentTarget)).find("#woocommerce-login-nonce").val(),f.post(n.options.ajax_url,{username:t.find("#username").val(),password:t.find("#password").val(),_wpnonce:i,login:1,_wc_product_reviews_pro_ajax_login:1},function(e){return n.handleModalAjaxResponse(e,t)})}),t.find("form.register").on("submit",function(e){var t,i;return e.preventDefault(),i=(t=f(e.currentTarget)).find("#woocommerce-register-nonce").val(),f.post(n.options.ajax_url,{email:t.find("#reg_email").val(),username:t.find("#reg_username").val(),password:t.find("#reg_password").val(),register:t.find('[name="register"]').val(),_wpnonce:i,_wc_product_reviews_pro_ajax_register:!0},function(e){return n.handleModalAjaxResponse(e,t)})}),f("#reviews").on("click",".js-wc-product-reviews-pro-show-login-modal",function(e){if(e.preventDefault(),!n.options.is_user_logged_in)return f(".guest-switcher").data("target","js-wc-product-reviews-pro-show-login-modal"),f("#guest_login, .guest-switcher, .switcher .login").hide(),f("#customer_login, .switcher .register").show(),n.showModal().one("login",function(){return window.location.assign(window.location.toString()+"#reviews"),window.location.reload()})})}},{key:"hideFlagForms",value:function(){return f(".contribution-flag-form").hide()}},{key:"initializeFlagging",value:function(){var a=this;return this.hideFlagForms(),f("#comments").on("click",".contribution-actions .js-toggle-flag-form",function(e){var t,i;return e.preventDefault(),t=f(e.currentTarget),f(".flag-response").remove(),i=t.data("comment-id"),f("form#flag-contribution-"+i).slideDown("fast").find("button").removeProp("disabled")}),f("#reviews").on("submit",".contribution-flag-form",function(e){var t,i,n,r;return e.preventDefault(),(i=f(e.currentTarget)).find("button").attr("disabled",!0),t=i.siblings(".contribution-actions").find(".feedback").html(""),n=i.find('input[name="comment_id"]').val(),r=i.find('input[name="flag_reason"]').val(),f.ajax({type:"POST",url:a.options.ajax_url,data:{action:"wc_product_reviews_pro_flag",security:a.options.nonce,comment_id:n,reason:r},success:function(e){return i.slideUp("fast").find("button").removeAttr("disabled"),t.show(),setTimeout(function(){return t.fadeOut()},2e3),e.data&&e.data.message?(t.text(e.data.message),e.success?(t.removeClass("error"),i.prev(".comment_container").find(".js-toggle-flag-form").addClass("done")):t.addClass("error")):t.text(this.options.i18n.flag_failed).addClass("error")}})})}},{key:"initializeTips",value:function(){return f(".js-tip").tipTip({attribute:"title",fadeIn:50,fadeOut:50,delay:200})}},{key:"handleModalAjaxResponse",value:function(e,t){var i,n,r=this;return e.success?this.refreshNonce(function(e){return r.options.is_user_logged_in=!0,t.prevAll(".woocommerce-error").remove(),r.hideModal().trigger("login")}):(t.prevAll(".woocommerce-error").remove(),t.before(null!=(i=null!=e&&null!=(n=e.data)?n.message:void 0)?i:this.options.i18n.error_login_signup))}},{key:"showModal",value:function(){var t=this,e=this.$modal,i=this.$overlay;this.$modalContainer;return f(document).on("keydown.modal",function(e){if(27===e.keyCode)return t.hideModal()}),i.fadeIn(100).on("click.modal",function(){return t.hideModal()}),f("body").addClass("wc-prp-modal"),e.find(".col-1").show().find(".woocommerce-Input").first().focus(),e.find(".col-2").hide(),e.trigger("showmodal")}},{key:"hideModal",value:function(){return f(document).off("keydown.modal"),f("body").removeClass("wc-prp-modal"),this.$overlay.hide().off("click.modal"),this.$modal.trigger("hidemodal")}},{key:"refreshNonce",value:function(r){var a=this;return f.get(this.options.ajax_url,{action:"wc_product_reviews_pro_refresh_nonce"}).done(function(e){var t,i,n;return a.options.nonce=null!=e&&null!=(t=e.data)?t.nonce:void 0,a.options.user_id=null!=e&&null!=(i=e.data)?i.user_id:void 0,r(null!=e&&null!=(n=e.data)?n.nonce:void 0)})}},{key:"initializeReviewEditing",value:function(){var u=this;return f("#reviews").on("click",".edit-comment",function(e){var s,t,c,l,i;return e.preventDefault(),t=f(e.currentTarget),c=t.siblings(".feedback").html(""),s=t.data("comment-id"),i=f('input[name="comment_post_ID"]').val(),l=f(".form-review"),f.ajax({type:"POST",url:u.options.ajax_url,data:{action:"wc_product_reviews_pro_get_review",security:u.options.nonce,comment_id:s,product_id:i},success:function(e){var t,i,n,r,a,o;return l[0].reset(),l.find(".review_attachment").remove(),e.success?(c.removeClass("error"),f("html, body").animate({scrollTop:f("#review_form_wrapper").offset().top-100},"medium"),o=e.data.review,f("#review_title").val(o.title),f("#review_comment").val(o.content),f("#comment_ID").val(s),l.find(".attachment-file").hide(),l.find(".attachment-url").hide(),""!==o.rating&&f("#review_rating_"+o.rating).prop("checked",!0),""!==o.attachment_type&&(f('input[name="review_attachment_type"]').prop("checked",!1),f("#review_attachment_type_"+o.attachment_type).prop("checked",!0),f("#review_attachment_type_field").data("prev-value",o.attachment_type)),r=":not(.attachment-url)",""!==o.attachment_url&&(f("#review_attachment_url").val(o.attachment_url),r=""),n=":not(.attachment-file)",""!==o.attachment_id&&(n="",a=f("<a>").addClass("remove_attachment").attr("href","#").text(u.options.i18n.remove_attachment),t=f("<img>").attr("src",o.attachment_file_url),(i=f("<div>").addClass("review_attachment").html(a)).append(t),l.find(".attachment-file").append(i)),"yes"===o.subscribed?f("#subscribe_to_replies").prop("checked",!0):f("#subscribe_to_replies").prop("checked",!1),f(".star-rating-selector").removeClass("change-rating"),f("#review_form_wrapper").hasClass("loading")&&f("#review_form_wrapper").removeClass("loading"),l.find(".form-row:hidden:not(:contains(.input-hidden))"+r+n).slideDown("fast"),l.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden))"+r+n).slideDown("fast")):(c.addClass("error"),c.text(e.data.message),setTimeout(function(){return c.fadeOut()},2e3))}})})}},{key:"initializeReviewUpdating",value:function(){var m=this;return f(".form-review").on("click",".update-review",function(e){var t,i,n,r,a,o,s,c,l,u,d,p,h=f("#review_comment").val();if(""!==h)return u=f(".form-review .response"),d=f("#review_title").val(),n=f("#comment_ID").val(),s=f('input[name="comment_post_ID"]').val(),c=f('input[name="review_rating"]:checked').val(),i=f("#review_attachment_url").val(),l=f(".form-review .remove_attachment").length,(r=0)<f("#review_attachment_file").length&&0<f("#review_attachment_file")[0].files.length?(a=f("#review_attachment_file")[0].files[0],r=1):a="",t=0<f('input[name="review_attachment_type"]:checked').length?f('input[name="review_attachment_type"]:checked').val():"",p=f("#subscribe_to_replies").is(":checked")?"yes":"no",(o=new FormData).append("action","wc_product_reviews_pro_update_review"),o.append("security",m.options.nonce),o.append("review_title",d),o.append("review_content",h),o.append("comment_id",n),o.append("product_id",s),o.append("rating",c),o.append("attachment_url",i),o.append("attachment_type",t),o.append("delete_attachment",l),o.append("files",a),o.append("file_changed",r),o.append("subscribed",p),f.ajax({type:"POST",url:m.options.ajax_url,data:o,processData:!1,contentType:!1,success:function(e){return u.text(e.data.message),u.css("display","inline-block"),e.success?(u.removeClass("error"),setTimeout(function(){var e=-1!==window.location.href.indexOf("?")?"&":"?";return window.location.href=window.location.href+e+"updated="+n},2e3)):u.addClass("error")}});f("#review_comment").after('<span class="wc-product-reviews-pro-validation-error">'+m.options.i18n.error_required+"</span>")})}},{key:"checkReviewUpdated",value:function(){var e,t=window.location.href,i=new RegExp("[?&]updated(=([^&#]*)|&|#|$)").exec(t);if(i&&i[2])return e=decodeURIComponent(i[2].replace(/\+/g," ")),f(".wc-tabs li").removeClass("active"),f(".wc-tabs li.reviews_tab").addClass("active"),f(".wc-tabs-wrapper .wc-tab").hide(),f("#tab-reviews").show(),f("html, body").animate({scrollTop:f("#comment-"+e).offset().top-100},"medium"),window.history.replaceState(null,null,location.href.replace(/&?[&?]updated=([^&]$|[^&]*)/i,""))}},{key:"removeReviewAttachment",value:function(){return f(".form-review").on("click",".remove_attachment",function(e){return e.preventDefault(),f(".form-review").find(".review_attachment").remove()})}},{key:"emptyReviewAttchmentURL",value:function(){return f("#review_attachment_file").on("change",function(e){return f("#review_attachment_url").val("")})}},{key:"initializeDefaultReviewEditing",value:function(){var i=this;return f(".form-review").on("click",".change-rating",function(e){var t;return e.preventDefault(),f("#review_form_wrapper").addClass("loading"),t=f('input[name="comment_post_ID"]').val(),f.ajax({type:"POST",url:i.options.ajax_url,data:{action:"wc_product_reviews_pro_get_recent_review",security:i.options.nonce,product_id:t},success:function(e){var t;if(e.success)return t=e.data.review,f("#comment-"+t+" .edit-comment").trigger("click")}})})}},{key:"checkGuestSaveReview",value:function(){var p=this;return f(".form-review").on("click","button[type=submit]",function(e){var c,t,l,u,d;if(!p.options.is_user_logged_in)return e.preventDefault(),p.options.comment_registration?(f(".guest-switcher").data("target","form-contribution"),f("#guest_login, .guest-switcher, .switcher .login").hide(),f("#customer_login, .switcher .register").show(),p.showModal().one("login",function(){return f(".form-review").get(0).submit()})):(c=f("#review_email").val(),d=f("#review_comment").val(),t=f("#review_author").val(),l=f('input[name="comment_post_ID"]').val(),u=f(".form-review .response"),""===d||""===c||""===t?void f(".form-review").submit():f.ajax({type:"POST",url:p.options.ajax_url,data:{action:"wc_product_reviews_pro_check_review",security:p.options.nonce,email:c,product_id:l},success:function(e){var t,i,n,r,a,o,s;return e.success?(u.removeClass("error").text("").css("display","none"),0<parseInt(e.data.count)?confirm(p.options.i18n.review_update_confirmation)?(s=f("#review_title").val(),a=f('input[name="review_rating"]:checked').val(),i=f("#review_attachment_url").val(),o=f(".form-review .remove_attachment").length,n=0<f("#review_attachment_file")[0].files.length?f("#review_attachment_file")[0].files[0]:"",t=0<f('input[name="review_attachment_type"]:checked').length?f('input[name="review_attachment_type"]:checked').val():"",(r=new FormData).append("action","wc_product_reviews_pro_review_update_confirmation"),r.append("security",p.options.nonce),r.append("email",c),r.append("review_title",s),r.append("review_content",d),r.append("product_id",l),r.append("rating",a),r.append("attachment_url",i),r.append("attachment_type",t),r.append("delete_attachment",o),r.append("files",n),f.ajax({type:"POST",url:p.options.ajax_url,data:r,processData:!1,contentType:!1,success:function(e){return e.success?u.removeClass("error").text(e.data.message).css("display","inline-block"):u.addClass("error").text(e.data.message).css("display","inline-block"),setTimeout(function(){return u.fadeOut()},2e3)}})):void 0:f(".form-review").submit()):void 0!==e.data.type?alert(e.data.message):(u.addClass("error").text(e.data.message).css("display","inline-block"),setTimeout(function(){return u.fadeOut()},2e3))}}))})}},{key:"initializeGuestWatch",value:function(){return f("#wc-product-reviews-pro-modal").on("click",".guest-link",function(e){return e.preventDefault(),f("#guest_login, #guest_login .col-1, .switcher .login, .switcher .register").show(),f("#customer_login, .guest-switcher").hide()}),f("#wc-product-reviews-pro-modal").on("click",".switcher .register a",function(e){return e.preventDefault(),f("#guest_login, #customer_login .col-1, .switcher .register").hide(),f("#customer_login, #customer_login .col-2, .switcher .login").show(),"notification"===f(".guest-switcher").data("target")?f(".guest-switcher").show():f(".guest-switcher").hide()}),f("#wc-product-reviews-pro-modal").on("click",".switcher .login a",function(e){return e.preventDefault(),f("#guest_login, #customer_login .col-2, .switcher .login").hide(),f("#customer_login, #customer_login .col-1, .guest-switcher, .switcher .register").show(),"notification"===f(".guest-switcher").data("target")?f(".guest-switcher").show():f(".guest-switcher").hide()})}},{key:"submitGuestWatch",value:function(){var a=this;return f(".woocommerce-form-guest").on("click",".guest-watch",function(e){var t,i,n,r;return e.preventDefault(),i=f("#guest_email").val(),r=f('input[name="wc-product-review-pro-guest-nonce"]').val(),t=f("#guest-comment-id").val(),n=f("#comment-"+t).find(".contribution-actions .feedback").html(""),f.ajax({type:"POST",url:a.options.ajax_url,data:{action:"wc_product_reviews_pro_guest_watch",security:r,email:i,comment_id:t},success:function(e){return e.success?(a.hideModal(),n.css("display","inline-block"),setTimeout(function(){return n.fadeOut()},2e3),n.removeClass("error"),n.text(e.data.message)):(n.css("display","none"),n.text(""),f("#guest_login .woocommerce-error").remove(),f('<ul class="woocommerce-error"><li>'+e.data.message+"</li></ul>").insertBefore(".woocommerce-form-guest"))}})})}}]),e=i,f(window).load(function(){return new e(window.wc_product_reviews_pro)})}).call(void 0);