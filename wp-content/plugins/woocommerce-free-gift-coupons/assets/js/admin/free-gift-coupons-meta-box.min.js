/*! woocommerce-free-gift-coupons 3.3.0 */

var WC_Free_Gift_Coupons={};!function(i){i.Product=Backbone.Model.extend({defaults:{quantity:1,title:"",product_id:"",variation_id:"",gift_id:""},initialize:function(){this.get("gift_id").length||this.set("gift_id",0<this.get("variation_id")?this.get("variation_id"):this.get("product_id"))}}),i.ProductsCollection=Backbone.Collection.extend({model:i.Product,el:"#wc-free-gift-container"}),i.productView=Backbone.View.extend({model:i.Product,tagName:"tr",events:{"click .delete-product":"removeProduct","change .product-quantity :input":"setQuantity"},template:wp.template("wc-free-gift-product"),render:function(){return this.$el.html(this.template(this.model.toJSON())),this},reorder:function(e,t){this.$el.trigger("update-sort",[this.model,t])},removeProduct:function(e){e.preventDefault(),this.model.destroy(),i.productList.render()},setQuantity:function(e){value=this.$el.find(".product-quantity :input").val(),this.model.set("quantity",value)}}),i.productListTable=Backbone.View.extend({el:"#wc-free-gift-table",template:wp.template("wc-free-gift-products-table-header"),addSingle:function(e){e=new i.productView({model:e});this.$el.find("tbody").prepend(e.render().el)},addProduct:function(e,t){Product=new i.Product(t),this.collection.add(Product,{at:0}),this.render()},events:{"click .delete-product":"removeProduct",addFreeGiftProduct:"addProduct"},render:function(){return this.$el.children().remove(),this.collection.length&&(this.$el.html(this.template()),this.collection.each(function(e){this.$el.find("tbody").append(new i.productView({model:e}).render().el)},this)),this}}),i.initApplication=function(){i.productCollection=new i.ProductsCollection(woocommerce_free_gift_coupon_meta_i18n.free_gifts),i.productList=new i.productListTable({collection:i.productCollection}),i.productList.render()},jQuery(function(t){i.initApplication(),t("#wc-free-gift-table").sortable({items:"tbody > tr",handle:".product-title",axis:"y",opacity:.5,grid:[20,10],tolerance:"pointer"}),t(document.body).trigger("wc-enhanced-select-init"),t("#free_gift_ids").hasClass("select2-hidden-accessible")&&t("#free_gift_ids").on("select2:select",function(e){e=e.params.data;e.id.length&&(e={gift_id:e.id,title:e.text},t("#wc-free-gift-table").trigger("addFreeGiftProduct",e),t(this).val([]).trigger("change"),t("#wc-free-gift-table").sortable("refresh"))}),t("select#discount_type").change(function(){var e=t(this).val();$toggle_fields=t(".coupon_amount_field"),coupon_types=jQuery.parseJSON(woocommerce_free_gift_coupon_meta_i18n.coupon_types),-1!==t.inArray(e,coupon_types)?(t(".show_if_free_gift").show(),"free_gift"==e?$toggle_fields.hide():$toggle_fields.show()):(t(".show_if_free_gift").hide(),$toggle_fields.show())}).trigger("change")})}((jQuery,WC_Free_Gift_Coupons));