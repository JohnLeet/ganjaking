!function(){"use strict";function posts_settings(){this.$snippets=null,this.$loader=null,this.init=function(){var self=this;self.$snippets=jQuery("#wpb_rs_snippets"),self.$loader=self.$snippets.parent().children(".wpb-rs-loader"),jQuery(document).on("click",".wpb-rs-add-snippet",function(e){e.preventDefault(),self.add_snippet()}),jQuery(document).on("click",".wpb-rs-remove-snippet",function(e){e.preventDefault(),self.remove_snippet(jQuery(this))}),jQuery(document).on("click",".wpb-rs-load-snippets",function(e){e.preventDefault(),self.load_snippets(function(data){self.after_load_snippets(data)})}),jQuery(document).on("click",".wpb-rs-toggle-snippet",function(e){e.preventDefault(),self.toggle_snippet(jQuery(this).closest(".wpb-rs-single-snippet"))}),jQuery(document).on("click",".wpb-rs-snippet-closed",function(e){jQuery(this).hasClass("wpb-rs-snippet-closed")&&self.toggle_snippet(jQuery(this).closest(".wpb-rs-single-snippet"))})},this.on_ajax_before_send=function(){this.$loader.css("display","block")},this.on_ajax_complete=function(){this.$loader.css("display","none")},this.add_snippet=function(){var self=this;this.load_snippets(self.after_load_snippets),jQuery.ajax({url:WPB_RS_POSTS.rest_url+"/form_new/",dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",WPB_RS_POSTS.nonce),self.on_ajax_before_send()},error:function(xhr,text_status,error){rich_snippets_errors.ajax_error_handler(xhr,text_status,error)},data:{post_id:WPB_RS_POSTS.post_id},method:"GET"}).done(function(data){self.setup_form(data.form,!1)}).fail(function(xhr,text_status,error){window.rich_snippets_errors.ajax_error_handler(xhr,text_status,error)}).always(function(){self.on_ajax_complete()})},this.setup_form=function(form,toggle){var $snippet_form=jQuery(form);this.$snippets.append($snippet_form),new rich_snippets.snippet($snippet_form).init(),"toggle"===toggle&&this.toggle_snippet($snippet_form)},this.remove_snippet=function($button){var self=this,snippet_id=$button.closest(".wpb-rs-single-snippet").find(".wpb-rs-schema-main").data("uid");jQuery.ajax({url:WPB_RS_POSTS.rest_url+"/snippets_delete/",dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",WPB_RS_POSTS.nonce),self.on_ajax_before_send()},data:{post_id:WPB_RS_POSTS.post_id,snippet_ids:[snippet_id]},method:"DELETE"}).done(function(data){$button.closest(".wpb-rs-single-snippet").remove()}).fail(function(xhr,text_status,error){rich_snippets_errors.ajax_error_handler(xhr,text_status,error)}).always(function(){self.on_ajax_complete()})},this.after_load_snippets=function(data){var self=this;data.forms.forEach(function(val){self.setup_form(val,"toggle")}),this.$snippets.data("snippets-loaded",1),this.$snippets.find(".wpb-rs-available-schemas-text").remove(),rs_fields.init(this.$snippets)},this.load_snippets=function(callback,always,form_data,snippet_export){if(form_data=void 0!==form_data?form_data:{},snippet_export=void 0!==snippet_export?snippet_export:{},callback=void 0!==callback?callback:function(data){},always=void 0!==always?always:function(){self.on_ajax_complete()},!(Object.keys(form_data).length<=0&&1===parseInt(this.$snippets.data("snippets-loaded")))){var self=this,settings={url:WPB_RS_POSTS.rest_url+"/snippets_forms/",dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",WPB_RS_POSTS.nonce),self.on_ajax_before_send()},data:{post_id:WPB_RS_POSTS.post_id,form_data:form_data},method:"POST"};0<Object.keys(snippet_export).length&&(settings.contentType="application/json; charset=utf-8",settings.data=snippet_export,settings.url=settings.url+"?post_id="+WPB_RS_POSTS.post_id),jQuery.ajax(settings).done(callback).fail(function(xhr,text_status,error){window.rich_snippets_errors.ajax_error_handler(xhr,text_status,error)}).always(always)}},this.toggle_snippet=function($snippet){var $toggled_text=$snippet.find("> .wpb-rs-type"),status=1===$toggled_text.length?"closed":"open";if("open"==status){$snippet.addClass("wpb-rs-snippet-closed");var toggled_text=$snippet.find(".wpb-rs-schema-main").data("type");$snippet.prepend(jQuery('<p class="wpb-rs-type">'+toggled_text+"</p>")),$snippet.find(".wpb-rs-toggle-snippet span").addClass("dashicons-arrow-up-alt2").removeClass("dashicons-arrow-down-alt2")}else"closed"==status&&($snippet.removeClass("wpb-rs-snippet-closed"),$toggled_text.remove(),$snippet.find(".wpb-rs-toggle-snippet span").removeClass("dashicons-arrow-up-alt2").addClass("dashicons-arrow-down-alt2"))}}jQuery(document).ready(function(){window.rich_snippets.posts=new posts_settings,window.rich_snippets.posts.init()})}();