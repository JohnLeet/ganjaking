/********************************************
 * REVOLUTION 6.3+ EXTENSION - VIDEO SCROLL
 * @version: 2.0.3 (12.02.2021)
 * @requires jquery.themepunch.revolution.js
 * @author ThemePunch
*********************************************/

(function(){function a(a){var b;if(k[a].layers!==void 0)for(var c in k[a].layers.static)k[a].layers.static.hasOwnProperty(c)&&void 0===b&&0<=c.indexOf("scrollvideo")&&(b={index:c,layer:k[a].layers.static[c]});return b}function b(a,b){k[a].scrollvideo.params.spinner&&window.requestAnimationFrame(function(){"show"===b&&!0!==k[a].loaderVisible&&k[a].loader!==void 0&&null!==k[a].loader[0]?(k[a].loader[0].style.display="block",k[a].loaderVisible=!0):"hide"==b&&!0===k[a].loaderVisible&&k[a].loader!==void 0&&null!==k[a].loader[0]&&(k[a].loader[0].style.display="none",k[a].loaderVisible=!1)})}function c(a){if(k[a].scrollvideo.loadedImageAmount<k[a].scrollvideo.range.len){if(10>k[a].scrollvideo.currentLoadingImageAmount&&0<k[a].scrollvideo.loadPrioList.length){var d=k[a].scrollvideo.loadPrioList.shift();k[a].scrollvideo.frames[d]=k[a].scrollvideo.frames[d]===void 0?{status:"empty",img:new Image,src:k[a].scrollvideo.params.dir+"/"+e(d,k[a].scrollvideo.params.fps,10*parseFloat(k[a].scrollvideo.params.quality))+"?ver="+k[a].scrollvideo.params.ver}:k[a].scrollvideo.frames[d],("video"===k[a].scrollvideo.framesource&&k[a].scrollvideo.imgs[d]!==void 0||"images"===k[a].scrollvideo.framesource&&k[a].scrollvideo.frames[d]!==void 0)&&(b(a,"show"),k[a].scrollvideo.params.scroll&&!0!==k[a].scrollvideo.blockScroll&&k[a].fixedScrollOnState&&(k[a].scrollvideo.blockScroll=!0,window.addEventListener("wheel",f,{passive:!1})),"empty"===k[a].scrollvideo.frames[d].status&&(k[a].scrollvideo.frames[d].img.onload=function(){k[a].scrollvideo.frames[d].status="loaded",k[a].scrollvideo.frames[d].ratio=k[a].scrollvideo.frames[d].img.naturalHeight/k[a].scrollvideo.frames[d].img.naturalWidth,k[a].scrollvideo.frames[d].width=k[a].scrollvideo.frames[d].img.naturalWidth,k[a].scrollvideo.frames[d].height=k[a].scrollvideo.frames[d].img.naturalHeight,h(a),k[a].scrollvideo.currentLoadingImageAmount--,k[a].scrollvideo.loadedImageAmount++,c(a)},k[a].scrollvideo.frames[d].img.src="images"===k[a].scrollvideo.framesource?k[a].scrollvideo.frames[d].src:k[a].scrollvideo.imgs[d],k[a].scrollvideo.currentLoadingImageAmount++))}setTimeout(function(){c(a)},50)}else b(a,"hide"),k[a].scrollvideo.params.scroll&&!0===k[a].scrollvideo.blockScroll&&(k[a].scrollvideo.blockScroll=!1,window.removeEventListener("wheel",f,{passive:!1}))}function d(a,b,c,d){var e=k[a].module.height/k[a].module.width;if(c<=e&&"contain"===d||(()=>e&&"cover"===d)){var f=k[a].module.width*c;k[a].scrollvideo.ctx.drawImage(b,0,(k[a].module.height-f)/2,k[a].module.width,f)}if(c>e&&"contain"===d||c<e&&"cover"===d){var g=k[a].module.width*e/c;k[a].scrollvideo.ctx.drawImage(b,(k[a].module.width-g)/2,0,g,k[a].module.height)}}function e(b,c,d){return b=""+b,c=""+c,d=""+d,b=1==b.length?"00"+b:2==b.length?"0"+b:b,c=1==c.length?"0"+c:c,d=1==d.length?"0"+d:d,b=b+"_f"+c+"_q"+d+".jpg",b}function f(a){a.preventDefault()}function g(a,b){k[a].scrollvideo.loadPrioList=[],k[a].scrollvideo.loadPrioList.push(b);for(var c=b;1<c&&10>k[a].scrollvideo.loadPrioList.length;)c--,void 0===k[a].scrollvideo.frames[c]&&k[a].scrollvideo.loadPrioList.push(c);for(c=b;c<k[a].scrollvideo.range.last&&25>k[a].scrollvideo.loadPrioList.length;)c++,void 0===k[a].scrollvideo.frames[c]&&k[a].scrollvideo.loadPrioList.push(c);for(var d=k[a].scrollvideo.range.first;d<=k[a].scrollvideo.range.last;d++)void 0===k[a].scrollvideo.frames[d]&&-1==jQuery.inArray(d,k[a].scrollvideo.loadPrioList)&&k[a].scrollvideo.loadPrioList.push(d)}function h(a,b,c){b===void 0?b=k[a].scrollvideo.requestedFrame:k[a].scrollvideo.requestedFrame=b,k[a].scrollvideo.frames[b]===void 0?g(a,b):"loaded"===k[a].scrollvideo.frames[b].status&&(k[a].scrollvideo.lastShownFrame!==b||c)&&(k[a].scrollvideo.lastShownFrame=b,d(a,k[a].scrollvideo.frames[b].img,k[a].scrollvideo.frames[b].ratio,"cover"))}function i(a){k[a].scrollvideo.canvas.width=k[a].module.width,k[a].scrollvideo.canvas.height=k[a].module.height}function j(a){1==k[a].slayers.length&&-1===k[a].slayers[0].className.indexOf("rs-stl-back")&&(k[a].slayers[0].className+=" rs-stl-back"),k[a].scrollvideo.range={first:1,last:k[a].scrollvideo.params.last},k[a].scrollvideo.range.len=k[a].scrollvideo.range.last-k[a].scrollvideo.range.first,k[a].scrollvideo.loadedImageAmount=0,k[a].scrollvideo.currentLoadingImageAmount=0,k[a].scrollvideo.loadPrioList=[],k[a].scrollvideo.frames={},k[a].scrollvideo.imgs=[],k[a].scrollvideo.canvas=document.createElement("canvas"),k[a].scrollvideo.canvas.style.width="100%",k[a].scrollvideo.canvas.style.height="100%",k[a].scrollvideo.ctx=k[a].scrollvideo.canvas.getContext("2d"),k[a].scrollvideo.video.layer.appendChild(k[a].scrollvideo.canvas),k[a].scrollvideo.params.winoffset=k[a].scrollvideo.params.winoffset===void 0?"0%":k[a].scrollvideo.params.winoffset,k[a].scrollvideo.params.winoffsetend=k[a].scrollvideo.params.winoffsetend===void 0?"50%":k[a].scrollvideo.params.winoffsetend,k[a].scrollvideo.params.winoffset_type=0<=(""+k[a].scrollvideo.params.winoffset).indexOf("%")?"%":"px",k[a].scrollvideo.params.winoffsetend_type=0<=(""+k[a].scrollvideo.params.winoffsetend).indexOf("%")?"%":"px",k[a].scrollvideo.params.winoffset=parseInt(k[a].scrollvideo.params.winoffset,0)/("%"===k[a].scrollvideo.params.winoffset_type?100:1),k[a].scrollvideo.params.winoffsetend=parseInt(k[a].scrollvideo.params.winoffsetend,0)/("%"===k[a].scrollvideo.params.winoffsetend_type?100:1),k[a].scrollvideo.params.ver=k[a].scrollvideo.params.ver===void 0?"6.3.0":k[a].scrollvideo.params.ver,i(a),k[a].scrollvideo.framesource=k[a].scrollvideo.params.dir===void 0&&k[a].scrollvideo.params.mp4!==void 0?"video":"images",window.addEventListener("resize",function(){clearTimeout(k[a].scrollvideo.resizetimer),k[a].scrollvideo.resizetimer=setTimeout(function(){i(a),h(a,void 0,!0)},100)}),k[a].c.on("timeline_scroll_processed",function(){var b="%"===k[a].scrollvideo.params.winoffset_type?k.lastwindowheight*k[a].scrollvideo.params.winoffset:k[a].scrollvideo.params.winoffset,c="%"===k[a].scrollvideo.params.winoffset_type?k.lastwindowheight*k[a].scrollvideo.params.winoffsetend:k[a].scrollvideo.params.winoffsetend,d=0-(k[a].scrollProgBasics.top-b),e=k[a].scrollProgBasics.height+k.lastwindowheight-(k.lastwindowheight+c),f=Math.min(1,Math.max(0,d/e)),g=Math.round(k[a].scrollvideo.range.len*f)+k[a].scrollvideo.range.first;h(a,g)}),c(a),h(a,1)}var k;window.RevSliderScrollvideo=function(a,b){k=jQuery.fn.revolution,k!==void 0&&a!==void 0&&a[0].id!==void 0?l(a[0].id,b):a.one("revolution.slide.onloaded",function(){k=jQuery.fn.revolution,k!==void 0&&a!==void 0&&a[0].id!==void 0&&l(a[0].id,b)})};var l=function(b,c){return(k[b].scrollvideo=void 0===k[b].scrollvideo?{params:c}:k[b].scrollvideo,!k[b].initEnded)?void setTimeout(function(){l(b)},100):(k[b].scrollvideo.video=a(b),void 0===k[b].scrollvideo.video?void setTimeout(function(){l(b)},100):void(void 0!==k[b].scrollvideo.params&&j(b)))}})(jQuery);