jQuery(function(p){var e=!1;p(document.body).on("keyup keydown",function(t){e=t.ctrlKey||t.metaKey});function i(){p('[name^="per_product_order"]').each(function(t,e){p(e).val(t)})}p("body").on("init_shipping_per_product",function(){p("input#_per_product_shipping").change(),p("input.variable_is_virtual").change(),p(".enable_per_product_shipping").change(),p("body").trigger("init_shipping_per_product_sortable")}).on("wcspp_add_error_tip",function(t,e,r){var i=e.position();0===e.parent().find(".wc_error_tip").length&&(e.after('<div class="wc_error_tip '+r+'">'+wc_shipping_per_product_errors[r]+"</div>"),e.parent().find(".wc_error_tip").css("left",i.left+e.width()-e.width()/2-p(".wc_error_tip").width()/2).css("top",i.top+e.height()).fadeIn("100"))}).on("wcspp_remove_error_tip",function(t,e,r){e.parent().find(".wc_error_tip."+r).fadeOut("100",function(){p(this).remove()})}).on("blur",".wcspp_country_validation",function(){var t=jQuery(this);0<t.parent().find(".wc_error_tip").length&&t.val("")}).on("keyup",".wcspp_country_validation",function(){var t,e=p(this).val(),r=!1;p(this).is(".wcspp_country_validation")&&(t="i18n_incorrect_country_code",void 0===wc_shipping_per_product_countries[e]&&2===e.length&&(r=!0)),r?p(document.body).triggerHandler("wcspp_add_error_tip",[p(this),t]):p(document.body).triggerHandler("wcspp_remove_error_tip",[p(this),t])}).on("init_shipping_per_product_sortable",function(){p(".per_product_shipping_rules tbody").sortable({items:"tr",cursor:"move",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){i(),e.item.removeAttr("style")}})}).on("change","input#_per_product_shipping",function(){p("input#_per_product_shipping").is(":checked")?p(this).closest("div").find(".per_product_shipping_rules").show():p(this).closest("div").find(".per_product_shipping_rules").hide()}).on("change","input.variable_is_virtual",function(){p(this).is(":checked")?p(this).closest(".woocommerce_variation").find(".enable_per_product_shipping").parent("label").hide():p(this).closest(".woocommerce_variation").find(".enable_per_product_shipping").parent("label").show()}),p(".woocommerce_variations").on("change",".enable_per_product_shipping",function(){p(this).is(":checked")?p(this).closest(".woocommerce_variation").find(".per_product_shipping_rules").show():p(this).closest(".woocommerce_variation").find(".per_product_shipping_rules").hide()}).on("woocommerce_variations_added woocommerce_variations_loaded",function(){p("body").trigger("init_shipping_per_product")}),p("#woocommerce-product-data").on("woocommerce_variations_added woocommerce_variations_loaded",function(){p("body").trigger("init_shipping_per_product")}),p("#woocommerce-product-data").on("focus",".per_product_shipping_rules input",function(){e||p(".per_product_shipping_rules tr").removeClass("current"),p(this).closest("tr").addClass("current")}).on("click",".per_product_shipping_rules input",function(){return p(this).focus(),!0}).on("click",".per_product_shipping_rules .remove",function(){var t=p(this).closest(".per_product_shipping_rules").find("tbody");return t.find("tr.current").length?(t.find("tr.current").find("input").val(""),t.find("tr.current").hide()):alert(wc_shipping_per_product_params.i18n_no_row_selected),!1}).on("click",".per_product_shipping_rules .insert",function(){var t=p(this).closest(".per_product_shipping_rules").find("tbody"),e=p(this).data("postid"),r='<tr>\t\t\t\t<td class="sort">&nbsp;<input type="hidden" value="" name="per_product_order['+e+'][new][]" /></td>\t\t\t\t<td class="country"><input type="text" class="wcspp_country_validation" value="" maxlength="2" placeholder="*" name="per_product_country['+e+'][new][]" /></td>\t\t\t\t<td class="state"><input type="text" value="" maxlength="7" placeholder="*" name="per_product_state['+e+'][new][]" /></td>\t\t\t\t<td class="postcode"><input type="text" value="" placeholder="*" name="per_product_postcode['+e+'][new][]" /></td>\t\t\t\t<td class="cost"><input type="text" class="wc_input_price input-text regular-input" value="0.00" placeholder="0.00" name="per_product_cost['+e+'][new][]" /></td>\t\t\t\t<td class="item_cost"><input type="text" class="wc_input_price input-text regular-input" value="0.00" placeholder="0.00" name="per_product_item_cost['+e+'][new][]" /></td>\t\t\t</tr>';return t.find("tr.current").length?t.find("tr.current").last().after(r):t.append(r),i(),!1}).on("click",".per_product_shipping_rules .export",function(t){t.preventDefault();var r=p(this),o=p(this).data("postid");r.attr("disabled",!0),p.ajax({url:ajaxurl,method:"post",data:{action:"wc_shipping_per_product_export_rules",product_id:o,security:p("#_export_nonce").val()},success:function(t){if(t.success){var i=wc_shipping_per_product_params.i18n_product_id+","+wc_shipping_per_product_params.i18n_country_code+","+wc_shipping_per_product_params.i18n_state+","+wc_shipping_per_product_params.i18n_postcode+","+wc_shipping_per_product_params.i18n_cost+","+wc_shipping_per_product_params.i18n_item_cost+"\n";p.each(t.rules,function(t,e){var r;r=[e.product_id,e.rule_country||"*",e.rule_state||"*",e.rule_postcode||"*",e.rule_cost||"0.00",e.rule_item_cost||"0.00"].join(),i=i+r+"\n"});var e=document.createElement("a");return e.href=URL.createObjectURL(new Blob([i])),e.download="per-product-rates-"+o+".csv",document.body.appendChild(e),e.click(),document.body.removeChild(e),r.attr("disabled",!1),!0}}})}),p("body").trigger("init_shipping_per_product")});
