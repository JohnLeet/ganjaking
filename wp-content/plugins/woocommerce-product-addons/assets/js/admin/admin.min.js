jQuery(function(t){"use strict";var i={getAddonOptions:function(){var a={security:wc_pao_params.nonce.get_addon_options,action:"wc_pao_get_addon_options"};return t.ajax({type:"POST",data:a,url:wc_pao_params.ajax_url})},getAddonField:function(a,o){a={security:wc_pao_params.nonce.get_addon_field,action:"wc_pao_get_addon_field",field_type:a,addon:o};return t.ajax({type:"POST",data:a,url:wc_pao_params.ajax_url})},getBlockParams:function(){return{message:null,overlayCSS:{background:"#fff",opacity:.6}}},refresh:function(){var a=t(".wc-pao-addon").length,o=t("#product_addons_data select.addon_field_type");0<a?(t(".wc-pao-toolbar").addClass("wc-pao-has-addons"),t(".wc-pao-toolbar .wc-pao-import-addons").show(),t(".wc-pao-toolbar .wc-pao-export-addons").show(),t(".wc-pao-addons").addClass("wc-pao-has-addons"),t("#product_addons_data").removeClass("onboarding"),t(".addon_fields_container").removeClass("pao_boarding__addons"),t(".pao_boarding__addons__message").hide()):(t(".wc-pao-toolbar").removeClass("wc-pao-has-addons"),t(".wc-pao-addons").removeClass("wc-pao-has-addons"),t(".wc-pao-toolbar .wc-pao-import-addons").hide(),t(".wc-pao-toolbar .wc-pao-export-addons").hide(),t("#product_addons_data").addClass("onboarding"),t(".addon_fields_container").addClass("pao_boarding__addons"),t(".pao_boarding__addons__message").show()),o.find('option[value="add"]').prop("selected","selected"),o.blur(),t(document.body).trigger("init_tooltips")},expandAllFields:function(){var a=t("#product_addons_data .wc-pao-addon");setTimeout(function(){a.removeClass("closed").addClass("open"),a.find(".wc-pao-addon-content").show()},50)},closeAllFields:function(){var a=t("#product_addons_data .wc-pao-addon");setTimeout(function(){a.removeClass("open").addClass("closed"),a.find(".wc-pao-addon-content").hide()},50)},addonRowIndexes:function(){t(".wc-pao-addons .wc-pao-addon").each(function(a,o){t(".wc-pao-addon-position",o).val(parseInt(t(o).index(".wc-pao-addons .wc-pao-addon")))})},runFieldSortable:function(){t(".wc-pao-addons").sortable({items:".wc-pao-addon",cursor:"move",axis:"y",handle:".wc-pao-addon-sort-handle",scrollSensitivity:40,helper:function(a,o){return o},start:function(a,o){o.item.css("border-style","dashed").css("border-color","orange")},stop:function(a,o){o.item.removeAttr("style"),i.addonRowIndexes()}})},runOptionSortable:function(){t(".wc-pao-addon-content-options-container").sortable({items:".wc-pao-addon-option-row",cursor:"move",axis:"y",handle:".wc-pao-addon-sort-handle",scrollSensitivity:40,helper:function(a,o){return o},start:function(a,o){o.item.css("border-style","dashed").css("border-width","1px").css("border-color","orange")},stop:function(a,o){o.item.removeAttr("style"),i.addonRowIndexes()}})},validateSettings:function(a){t(".wc-pao-error-message").remove(),t(".updated").remove();var o,d=!0,e=!0;return t(".wc-pao-addons").find(".wc-pao-addon").each(function(a){0===t(this).find(".wc-pao-addon-content-name").val().length?(t(this).addClass("wc-pao-error").find(".wc-pao-addon-content-name").addClass("wc-pao-error"),e=d=!1):t(this).find(".wc-pao-addon-content-name").removeClass("wc-pao-error");var o=t(this).find(".product_addon_type").val();t(this).find(".wc-pao-addon-option-row").each(function(){"multiple_choice"!==o&&"checkbox"!==o||0!==t(this).find(".wc-pao-addon-content-label input").val().length?t(this).find(".wc-pao-addon-content-label input").removeClass("wc-pao-error"):(t(this).find(".wc-pao-addon-content-label input").addClass("wc-pao-error"),t(this).parents(".wc-pao-addon").eq(0).addClass("wc-pao-error"),e=d=!1)}),e&&t(this).removeClass("wc-pao-error")}),!1===d&&(o=t('<div class="notice notice-error wc-pao-error-message"><p>'+wc_pao_params.i18n.required_fields+"</p></div>"),"product"===a?t(".wc-pao-addons").before(o):"global"===a&&t(".global-addons-form").before(o),t("html, body").animate({scrollTop:t(".wc-pao-error-message").offset().top-200},600)),d},render:function(a,o){var d;switch(o.find(".wc-pao-addon-main-settings-1 .wc-pao-col1").removeClass("full"),o.find(".wc-pao-addon-main-settings-1 .wc-pao-col2").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-image").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-label").addClass("full"),o.find(".wc-pao-addon-restrictions-select").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-2").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-required-setting").removeClass("hide").addClass("show"),a){case"multiple_choice":o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").removeClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("show").addClass("hide"),"images"===o.find(".wc-pao-addon-display-select").val()&&(o.find(".wc-pao-addon-content-image").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-label").removeClass("full"),o.find(".wc-pao-addon-content-option-header").text(wc_pao_params.i18n.options_header_with_image));break;case"checkbox":o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-image").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-label").addClass("full"),o.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide");break;case"custom_price":d=wc_pao_params.i18n.limit_price_range,o.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-select").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show");break;case"input_multiplier":o.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show"),d=wc_pao_params.i18n.limit_quantity_range;break;case"custom_text":d=wc_pao_params.i18n.limit_character_length,o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-2").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-select").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show"),"email"===o.find(".wc-pao-addon-restrictions-select").val()&&o.find(".wc-pao-addon-min-max").removeClass("show").addClass("hide");break;case"custom_textarea":d=wc_pao_params.i18n.limit_character_length,o.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show");break;case"file_upload":o.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide");break;case"heading":o.find(".wc-pao-addon-required-setting").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-1 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-main-settings-1 .wc-pao-col2").removeClass("show").addClass("hide");break;default:o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-2").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),d=wc_pao_params.i18n.restrictions,o.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide")}o.find(".wc-pao-addon-restriction-name").html(d),i.update_remove_addon_option_buttons(o)},update_remove_addon_option_buttons:function(a){a=a.find(".wc-pao-remove-option");a.length<2?a.attr("disabled","disabled"):a.removeAttr("disabled")},delay:function(a,o){clearTimeout(0),setTimeout(a,o)},init:function(){var s=t("#product_addons_data"),a=t("<input>"),o=t("<input>");a.attr("type","hidden"),a.attr("name","pao_post_control_var"),a.val("1"),o.attr("type","hidden"),o.attr("name","pao_post_test_var"),o.val("1"),s.prepend(a),s.append(o),t(".post-type-product").on("click",'#publishing-action input[name="save"]',function(){return i.validateSettings("product")}),t(".product_page_addons").on("click",'input[type="submit"]',function(){return i.validateSettings("global")}),s.on("keyup",".wc-pao-addon-content-name",function(){var a=t(this);t(this).removeClass("wc-pao-error"),t(".wc-pao-error-message").remove(),i.delay(function(){a.closest(".wc-pao-addon").find(".wc-pao-addon-name").text(a.val())},300)}).on("keyup",".wc-pao-addon-content-label input",function(){t(this).removeClass("wc-pao-error"),t(".wc-pao-error-message").remove()}).on("change","select.addon_field_type",function(){var e=t(".wc-pao-addons .wc-pao-addon").length,n=t(this),a=n.val(),o=i.getBlockParams();return s.block(o),setTimeout(function(){t.when(i.getAddonField(a)).then(function(a){a=(a=(a=a.html).replace(/{loop}/g,e)).replace(/closed/g,"open"),t(".wc-pao-addons").append(a);var a=t(".wc-pao-addons .wc-pao-addon").last(),o=n.val(),d=n.find('option[value="'+o+'"]').text(),d=(a.find(".product_addon_type").val(o),a.find(".wc-pao-addon-header .wc-pao-addon-type").html(d),i.render(o,a),i.refresh(),i.runOptionSortable(),t("select#product-type").val());t(".hide_if_"+d).hide(),t(".show_if_"+d).show(),s.unblock()})},250),!1}).on("change",".wc-pao-addon-display-select",function(){var a=t(this).val(),o=t(this).parents(".wc-pao-addon");"images"===a?(o.find(".wc-pao-addon-content-image").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-label").removeClass("full"),o.find(".wc-pao-addon-content-option-header").text(wc_pao_params.i18n.options_header_with_image)):(o.find(".wc-pao-addon-content-image").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-label").addClass("full"),o.find(".wc-pao-addon-content-option-header").text(wc_pao_params.i18n.options_header_default))}).on("click","button.wc-pao-add-option",function(){var o=t(this).closest(".wc-pao-addon"),d=o.index(".wc-pao-addon"),e=t(this).parents(".wc-pao-addon-content-option-rows").find(".wc-pao-addon-content-options-container");return t.when(i.getAddonOptions()).then(function(a){a=(a=a.html).replace(/{loop}/g,d),t(a).appendTo(e),"images"===o.find(".wc-pao-addon-display-select").val()&&(o.find(".wc-pao-addon-content-image").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-label").removeClass("full"),o.find(".wc-pao-addon-content-option-header").text(wc_pao_params.i18n.options_header_with_image)),i.update_remove_addon_option_buttons(o)}),!1}).on("click","a.wc-pao-remove-addon",function(a){return a.preventDefault(),t(this).closest(".wc-pao-addon").off(),t(".wc-pao-error-message").remove(),confirm(wc_pao_params.i18n.confirm_remove_addon)&&(a=t(this).closest(".wc-pao-addon"),t(a).find("input").val(""),t(a).remove()),t(".wc-pao-addons .wc-pao-addon").each(function(a,o){var d=a;t(this).find(".product_addon_position").val(d),t(this).find("select, input, textarea").prop("name",function(a,o){return o.replace(/\[[0-9]+\]/g,"["+d+"]")})}),i.refresh(),!1}).on("click",".wc-pao-remove-option",function(){var a=t(this).attr("disabled");return void 0!==a&&!1!==a||confirm(wc_pao_params.i18n.confirm_remove_option)&&(a=t(this).parents(".wc-pao-addon"),t(this).parents(".wc-pao-addon-option-row").remove(),(a=a.find(".wc-pao-remove-option")).length<2?a.attr("disabled","disabled"):a.removeAttr("disabled")),!1}).on("click",".wc-pao-expand-all",function(a){a.preventDefault(),i.expandAllFields()}).on("click",".wc-pao-close-all",function(a){a.preventDefault(),i.closeAllFields()}).on("click",".wc-pao-addon-description-enable",function(){t(this).is(":checked")?t(this).parents(".wc-pao-addons-secondary-settings").find(".wc-pao-addon-description").removeClass("hide").addClass("show"):t(this).parents(".wc-pao-addons-secondary-settings").find(".wc-pao-addon-description").removeClass("show").addClass("hide")}).on("change",".wc-pao-addon-option-price-type",function(){switch(t(this).val()){case"flat_fee":case"quantity_based":t(this).parents(".wc-pao-addon-content-price-type").removeClass("full").next(".wc-pao-addon-content-price").eq(0).removeClass("hide").addClass("show")}}).on("click",".wc-pao-addon-add-image",function(){var d=t(this).parent(),a=wp.media.frames.mediaFrame=wp.media({title:wc_pao_params.i18n.add_image_swatch,button:{text:wc_pao_params.i18n.add_image},library:{type:"image"},multiple:!1});a.on("select",function(){a.state().get("selection").map(function(a){var o;(a=a.toJSON()).id&&(o=(a.sizes.thumbnail||a).url,d.find(".wc-pao-addon-option-image-id").val(a.id),d.find(".wc-pao-addon-image-swatch img").prop("src",o),d.find(".wc-pao-addon-image-swatch").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-add-image").removeClass("show").addClass("hide"),d.find(".dashicons-plus").removeClass("show").addClass("hide"))})}),a.open()}).on("click",".wc-pao-addon-image-swatch",function(a){a.preventDefault();a=t(this).parent();a.find(".wc-pao-addon-option-image-id").val(""),a.find(".wc-pao-addon-image-swatch img").prop("src",""),a.find(".wc-pao-addon-image-swatch").removeClass("show").addClass("hide"),a.find(".wc-pao-addon-add-image").removeClass("hide").addClass("show"),a.find(".dashicons-plus").removeClass("hide").addClass("show")}).on("click",".wc-pao-addon-restrictions",function(){t(this).is(":checked")?t(this).parents(".wc-pao-addon-restrictions-container").find(".wc-pao-addon-restrictions-settings").removeClass("hide").addClass("show"):t(this).parents(".wc-pao-addon-restrictions-container").find(".wc-pao-addon-restrictions-settings").removeClass("show").addClass("hide")}).on("change",".wc-pao-addon-restrictions-select",function(){var a=t(this).val(),o=t(this).parents(".wc-pao-addon-restrictions-settings");"email"===a?o.find(".wc-pao-addon-min-max").removeClass("show").addClass("hide"):o.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show")}).on("click",".wc-pao-addon-id",function(){return!1}).on("click",".wc-pao-addon-adjust-price",function(){t(this).is(":checked")?t(this).parents(".wc-pao-addon-adjust-price-container").find(".wc-pao-addon-adjust-price-settings").removeClass("hide").addClass("show"):t(this).parents(".wc-pao-addon-adjust-price-container").find(".wc-pao-addon-adjust-price-settings").removeClass("show").addClass("hide")}),s.find(".wc-pao-addon").each(function(){var a=t(this).find(".product_addon_type").val();i.render(a,t(this))}),i.refresh(),s.on("click",".wc-pao-export-addons",function(){var a=s.find(".product_addons_export_string").val(),o=t("<input>");return t("body").append(o),o.val(a).select(),document.execCommand("copy"),o.remove(),alert(wc_pao_params.i18n.addons_exported),!1}),s.on("click",".wc-pao-import-addons",function(a){a.preventDefault(),t(this).blur();var o,d,a=window.prompt(wc_pao_params.i18n.import_addons_prompt);if(!a)return!1;d="undefined"!=typeof woocommerce_admin_meta_boxes&&woocommerce_admin_meta_boxes.post_id?(o=woocommerce_admin_meta_boxes.post_id,!1):(o=new URLSearchParams(window.location.search).get("edit"),!0);a={security:wc_pao_params.nonce.import_addons,action:"wc_pao_import_addons",import_product_addon:a,post_id:o,is_global:d};t.post(wc_pao_params.ajax_url,a,function(a){var e,o;a.success&&!0===a.success?(e=t("select#product-type").val(),o=i.getBlockParams(),s.block(o),alert(a.data.message),setTimeout(function(){t.each(a.data.addons,function(a,o){var d=o.type;t.when(i.getAddonField(d,o)).then(function(a){var a=a.html,o=t(".wc-pao-addons .wc-pao-addon").length,o=(a=a.replace(/{loop}/g,o),t(".wc-pao-addons").append(a),t(".wc-pao-addons .wc-pao-addon").last()),a=t("select.addon_field_type").find('option[value="'+d+'"]').text();o.find(".product_addon_type").val(d),o.find(".wc-pao-addon-header .wc-pao-addon-type").html(a),i.render(d,o),i.refresh(),i.runOptionSortable(),t(".hide_if_"+e).hide(),t(".show_if_"+e).show()})}),s.unblock(o),setTimeout(function(){var a=t(".wc-pao-addon-header:last");t("html, body").animate({scrollTop:a.offset().top-200},1e3)},1e3)},1e3)):a.data.message.length&&alert(a.data.message)})}),i.runFieldSortable(),i.runOptionSortable(),t(".global-addons-form .wc-pao-addon").each(function(){t(this).hasClass("closed")&&t(this).find(".wc-pao-addon-content").hide()}),t(".global-addons-form .wc-pao-addon-header").on("click",function(){var a=t(this).closest(".wc-pao-addon"),o=a.find(".wc-pao-addon-content");setTimeout(function(){a.toggleClass("closed").toggleClass("open"),o.stop().slideToggle()},50)}),t("#addons-table #doaction").on("click",function(a){if("delete"===t("#bulk-action-selector-top").val()&&!window.confirm(wc_pao_params.i18n.delete_addons_warning))return a.preventDefault(),!1}),t("#addons-table #doaction2").on("click",function(a){if("delete"===t("#bulk-action-selector-bottom").val()&&!window.confirm(wc_pao_params.i18n.delete_addons_warning))return a.preventDefault(),!1}),1<t(".wc-pao-addons .wc-pao-addon").length&&t(".wc-pao-toolbar").show(),t('[name*="addon_wc_booking_person_qty_multiplier"]').on("change",function(){var a=t(this).attr("name"),o=t(this).is(":checked");t('[name*="'+a+'"]').prop("checked",o)})}};i.init()});