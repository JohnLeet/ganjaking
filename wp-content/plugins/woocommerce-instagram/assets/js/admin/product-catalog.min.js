!function(s){"use strict";"undefined"!=typeof wc_instagram_product_catalog_params&&{$body:s("body"),$deleteLink:null,formFields:{},autoUpdateSlug:!0,init:function(){var t=this.getFormField("slug").val();this.autoUpdateSlug=""===t,this.toggleFormFields("slug",""!==t),s(".wc-instagram-field-editable-url").wc_instagram_editable_url(),wc_instagram_product_catalog_params.delete_link&&(this.$deleteLink=s(wc_instagram_product_catalog_params.delete_link),s("#mainform .woocommerce-save-button").after(this.$deleteLink)),this.initGoogleProductCategorySelects(),this.bindEvents()},bindEvents:function(){var o,a,n,c,r=this;this.getFormField("title").on("keyup",(o=function(){r.autoUpdateSlug&&r.refreshCatalogSlug(s(this).val())},n=!(a=1e3),function(){var t=this,e=arguments,i=n&&!c;clearTimeout(c),c=setTimeout(function(){c=null,n||o.apply(t,e)},a),i&&o.apply(t,e)})),this.getFormField("slug").on("wc_instagram_editable_url_change",function(t,e){r.refreshCatalogSlug(e)}),this.$body.on("wc_instagram_product_catalog_slug_updated",function(t,e){r.autoUpdateSlug=r.autoUpdateSlug&&""===e,r.toggleFormFields("slug",!0),r.getFormField("slug").val(e).trigger("change")}),this.$body.on("wc_instagram_subset_values_updated",function(t,e,i){var o;"product_types"===e&&(o=r.inSubset("variable",i),r.toggleFormFields(["virtual_products","downloadable_products"],r.inSubset("simple",i)),r.toggleFormFields("include_variations",o),r.toggleFormFields(["product_group_id","variation_description_field"],o&&r.getFormField("include_variations").prop("checked")))}),this.$body.on("wc_instagram_subset_fields_loaded",function(){r.filterByToggle(s("input[name=filter_by]:checked").val())}),this.getFormField("include_variations").on("change",function(){var t=s(this).prop("checked");r.toggleFormFields("product_group_id",t),r.toggleFormFields("variation_description_field",t)}).trigger("change"),this.getFormField("product_mpn").on("change",function(){r.toggleFormFields("custom_mpn","custom"===s(this).val())}).trigger("change"),this.getFormField("include_tax").on("change",function(){r.toggleFormFields("tax_country","base"!==wc_instagram_product_catalog_params.tax_based_on&&s(this).prop("checked"))}).trigger("change"),this.$deleteLink&&this.$deleteLink.on("click",function(t){if(!window.confirm(s(this).data("confirm")))return t.preventDefault(),!1}),this.getFormField("products_option").on("change",function(){r.productsOptionToggle(s(this).val())}),s(".form-table").on("change",".wc-instagram-gpc-select",function(){r.loadCategorySelect(s(this).val())}).on("change","input[name=filter_by]",function(){r.filterByToggle(s(this).val())})},getFormField:function(t){return this.formFields[t]||(this.formFields[t]=s("#"+t)),this.formFields[t]},toggleFormFields:function(t,i){var o=this;s.isArray(t)||(t=[t]),s.each(t,function(t,e){o.getFormField(e).closest("tr").toggle(i)})},refreshCatalogSlug:function(t){var e=this;t&&s.post({url:wc_instagram_product_catalog_params.ajax_url,data:{action:"wc_instagram_generate_product_catalog_slug",catalog_id:wc_instagram_product_catalog_params.catalog_id,catalog_title:t},dataType:"json",success:function(t){t.success&&e.$body.trigger("wc_instagram_product_catalog_slug_updated",t.data.slug)}})},inSubset:function(t,e){return""===e.option||"specific"===e.option&&-1!==e.values.indexOf(t)||"all_except"===e.option&&-1===e.values.indexOf(t)},initGoogleProductCategorySelects:function(){s(".wc-instagram-gpc-select:not(.select2-hidden-accessible)").selectWoo({width:"auto"})},filterByToggle:function(t){var e=t.replace("_","-");s(".show-if-"+e).closest("tr").show(),s(".hide-if-"+e).closest("tr").hide(),s(".wc-instagram-field-subset-option.show-if-"+e).each(function(){s(this).trigger("change")}),s(".wc-instagram-field-subset-option.hide-if-"+e).each(function(){s(this).closest("tr").nextAll("tr").slice(0,2).hide()}),"products"===t&&this.productsOptionToggle()},productsOptionToggle:function(t){t=t||this.getFormField("products_option").val();this.toggleFormFields("include_product_ids","specific"===t),this.toggleFormFields("exclude_product_ids","all_except"===t)},updateHiddenInput:function(t){s("#product_google_category").val(t)},loadCategorySelect:function(e){var i=this;e||s(".wc-instagram-gpc-select").each(function(){var t=s(this).val();if(""===t)return!1;e=t}),this.updateHiddenInput(e),s.post(window.wc_instagram_product_catalog_params.ajax_url,{action:"wc_instagram_refresh_google_product_category_field",_wpnonce:window.wc_instagram_product_catalog_params.nonce,catalog_id:window.wc_instagram_product_catalog_params.catalog_id,category_id:e}).done(function(t){var e;!t.success||(e=s(".wc-instagram-gpc-select").first().closest("tr")).length&&(e.replaceWith(t.data.output),i.initGoogleProductCategorySelects())})}}.init()}(jQuery);